import {
  HOST,
  PROMETHEUS_PORT,
  PROMETHEUS_PUSHGATEWAY_PORT,
  YDB_ENDPOINT,
  YDB_GRPC_PORT,
  YDB_IC_PORT,
  YDB_MON_PORT,
  YDB_TENANT
} from "./constants.js";
import"../main-ynsbc1hx.js";

// init/configs.ts
import { execSync } from "child_process";
var generateComposeFile = (ydbDatabaseNodeCount) => {
  let yqCommands = [];
  for (let i = 1;i <= ydbDatabaseNodeCount; i++) {
    let grpcPort = YDB_GRPC_PORT + i, monPort = YDB_MON_PORT + i, icPort = YDB_IC_PORT + i, database = `.services.["database-${i}"]`;
    yqCommands.push(`${database} = .services.["_database_template_"]`), yqCommands.push(`${database}.container_name = "ydb-database-${i}"`), yqCommands.push(`(${database}.command[] | select(line_comment == "GRPC_PORT")) = "${grpcPort}"`), yqCommands.push(`(${database}.command[] | select(line_comment == "MON_PORT")) = "${monPort}"`), yqCommands.push(`(${database}.command[] | select(line_comment == "IC_PORT")) = "${icPort}"`), yqCommands.push(`(${database}.ports[] | select(line_comment == "GRPC_PORT_MAP")) = "${grpcPort}:${grpcPort}"`), yqCommands.push(`(${database}.ports[] | select(line_comment == "MON_PORT_MAP")) = "${monPort}:${monPort}"`), yqCommands.push(`(${database}.ports[] | select(line_comment == "IC_PORT_MAP")) = "${icPort}:${icPort}"`), yqCommands.push(`${database}.healthcheck.test = "bash -c \\"exec 6<> /dev/tcp/${HOST}/${grpcPort}\\""`);
  }
  yqCommands.push('del(.services.["_database_template_"])'), yqCommands.push('.. style="" | (.. | select(tag == "!!str")) |= envsubst');
  let command = `yq eval '${yqCommands.join(" | ")}' ./init/cfg/compose.yml`;
  return execSync(command, {
    env: {
      ...process.env,
      HOST,
      PROMETHEUS_PORT: PROMETHEUS_PORT.toString(),
      PROMETHEUS_PUSHGATEWAY_PORT: PROMETHEUS_PUSHGATEWAY_PORT.toString(),
      YDB_TENANT,
      YDB_ENDPOINT,
      YDB_IC_PORT: YDB_IC_PORT.toString(),
      YDB_MON_PORT: YDB_MON_PORT.toString(),
      YDB_GRPC_PORT: YDB_GRPC_PORT.toString()
    }
  }).toString();
};
if (import.meta.url === new URL("./configs.ts", import.meta.url).href)
  console.log(generateComposeFile(2));
export {
  generateComposeFile
};

export { generateComposeFile };

//# debugId=B926AC17689E72CD64756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vaW5pdC9jb25maWdzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgImltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2VzcydcbmltcG9ydCB7XG5cdEhPU1QsXG5cdFBST01FVEhFVVNfUE9SVCxcblx0UFJPTUVUSEVVU19QVVNIR0FURVdBWV9QT1JULFxuXHRZREJfRU5EUE9JTlQsXG5cdFlEQl9HUlBDX1BPUlQsXG5cdFlEQl9JQ19QT1JULFxuXHRZREJfTU9OX1BPUlQsXG5cdFlEQl9URU5BTlQsXG59IGZyb20gJy4vY29uc3RhbnRzLmpzJ1xuXG4vLyBHZW5lcmF0ZSBDb21wb3NlIGZpbGUgYnkgdXNpbmcgeXEgdG8gZHVwbGljYXRlIGFuZCBtb2RpZnkgYSB0ZW1wbGF0ZSBzZXJ2aWNlXG5leHBvcnQgbGV0IGdlbmVyYXRlQ29tcG9zZUZpbGUgPSAoeWRiRGF0YWJhc2VOb2RlQ291bnQ6IG51bWJlcikgPT4ge1xuXHRjb25zdCB5cUNvbW1hbmRzOiBzdHJpbmdbXSA9IFtdXG5cblx0Zm9yIChsZXQgaSA9IDE7IGkgPD0geWRiRGF0YWJhc2VOb2RlQ291bnQ7IGkrKykge1xuXHRcdGNvbnN0IGdycGNQb3J0ID0gWURCX0dSUENfUE9SVCArIGlcblx0XHRjb25zdCBtb25Qb3J0ID0gWURCX01PTl9QT1JUICsgaVxuXHRcdGNvbnN0IGljUG9ydCA9IFlEQl9JQ19QT1JUICsgaVxuXHRcdGNvbnN0IGRhdGFiYXNlID0gYC5zZXJ2aWNlcy5bXCJkYXRhYmFzZS0ke2l9XCJdYFxuXG5cdFx0Ly8gQ29weSB0aGUgdGVtcGxhdGUgc2VydmljZVxuXHRcdHlxQ29tbWFuZHMucHVzaChgJHtkYXRhYmFzZX0gPSAuc2VydmljZXMuW1wiX2RhdGFiYXNlX3RlbXBsYXRlX1wiXWApXG5cblx0XHQvLyBVcGRhdGUgdW5pcXVlIHByb3BlcnRpZXNcblx0XHR5cUNvbW1hbmRzLnB1c2goYCR7ZGF0YWJhc2V9LmNvbnRhaW5lcl9uYW1lID0gXCJ5ZGItZGF0YWJhc2UtJHtpfVwiYClcblxuXHRcdC8vIFVwZGF0ZSBwb3J0cyBpbiB0aGUgJ2NvbW1hbmQnIGFycmF5IHVzaW5nIGNvbW1lbnRzIGFzIHJlbGlhYmxlIGFuY2hvcnNcblx0XHR5cUNvbW1hbmRzLnB1c2goYCgke2RhdGFiYXNlfS5jb21tYW5kW10gfCBzZWxlY3QobGluZV9jb21tZW50ID09IFwiR1JQQ19QT1JUXCIpKSA9IFwiJHtncnBjUG9ydH1cImApXG5cdFx0eXFDb21tYW5kcy5wdXNoKGAoJHtkYXRhYmFzZX0uY29tbWFuZFtdIHwgc2VsZWN0KGxpbmVfY29tbWVudCA9PSBcIk1PTl9QT1JUXCIpKSA9IFwiJHttb25Qb3J0fVwiYClcblx0XHR5cUNvbW1hbmRzLnB1c2goYCgke2RhdGFiYXNlfS5jb21tYW5kW10gfCBzZWxlY3QobGluZV9jb21tZW50ID09IFwiSUNfUE9SVFwiKSkgPSBcIiR7aWNQb3J0fVwiYClcblxuXHRcdC8vIFVwZGF0ZSBwb3J0IG1hcHBpbmdzIGluIHRoZSAncG9ydHMnIGFycmF5XG5cdFx0eXFDb21tYW5kcy5wdXNoKGAoJHtkYXRhYmFzZX0ucG9ydHNbXSB8IHNlbGVjdChsaW5lX2NvbW1lbnQgPT0gXCJHUlBDX1BPUlRfTUFQXCIpKSA9IFwiJHtncnBjUG9ydH06JHtncnBjUG9ydH1cImApXG5cdFx0eXFDb21tYW5kcy5wdXNoKGAoJHtkYXRhYmFzZX0ucG9ydHNbXSB8IHNlbGVjdChsaW5lX2NvbW1lbnQgPT0gXCJNT05fUE9SVF9NQVBcIikpID0gXCIke21vblBvcnR9OiR7bW9uUG9ydH1cImApXG5cdFx0eXFDb21tYW5kcy5wdXNoKGAoJHtkYXRhYmFzZX0ucG9ydHNbXSB8IHNlbGVjdChsaW5lX2NvbW1lbnQgPT0gXCJJQ19QT1JUX01BUFwiKSkgPSBcIiR7aWNQb3J0fToke2ljUG9ydH1cImApXG5cblx0XHQvLyBVcGRhdGUgdGhlIGhlYWx0aGNoZWNrIHBvcnQgdXNpbmcgYSBzaW1wbGUgZGlyZWN0IHBhdGhcblx0XHR5cUNvbW1hbmRzLnB1c2goYCR7ZGF0YWJhc2V9LmhlYWx0aGNoZWNrLnRlc3QgPSBcImJhc2ggLWMgXFxcXFwiZXhlYyA2PD4gL2Rldi90Y3AvJHtIT1NUfS8ke2dycGNQb3J0fVxcXFxcIlwiYClcblx0fVxuXG5cdC8vIENsZWFuIHVwIGJ5IGRlbGV0aW5nIHRoZSB0ZW1wbGF0ZVxuXHR5cUNvbW1hbmRzLnB1c2goJ2RlbCguc2VydmljZXMuW1wiX2RhdGFiYXNlX3RlbXBsYXRlX1wiXSknKVxuXG5cdC8vIFN1YnN0aXR1dGUgYWxsICR7Li4ufSB2YXJpYWJsZXMgd2l0aCB2YWx1ZXMgZnJvbSB0aGUgZW52aXJvbm1lbnRcblx0eXFDb21tYW5kcy5wdXNoKCcuLiBzdHlsZT1cIlwiIHwgKC4uIHwgc2VsZWN0KHRhZyA9PSBcIiEhc3RyXCIpKSB8PSBlbnZzdWJzdCcpXG5cblx0Y29uc3QgeXFTY3JpcHQgPSB5cUNvbW1hbmRzLmpvaW4oJyB8ICcpXG5cdGNvbnN0IGNvbW1hbmQgPSBgeXEgZXZhbCAnJHt5cVNjcmlwdH0nIC4vaW5pdC9jZmcvY29tcG9zZS55bWxgXG5cblx0cmV0dXJuIGV4ZWNTeW5jKGNvbW1hbmQsIHtcblx0XHRlbnY6IHtcblx0XHRcdC4uLnByb2Nlc3MuZW52LFxuXHRcdFx0SE9TVCxcblx0XHRcdFBST01FVEhFVVNfUE9SVDogUFJPTUVUSEVVU19QT1JULnRvU3RyaW5nKCksXG5cdFx0XHRQUk9NRVRIRVVTX1BVU0hHQVRFV0FZX1BPUlQ6IFBST01FVEhFVVNfUFVTSEdBVEVXQVlfUE9SVC50b1N0cmluZygpLFxuXHRcdFx0WURCX1RFTkFOVCxcblx0XHRcdFlEQl9FTkRQT0lOVCxcblx0XHRcdFlEQl9JQ19QT1JUOiBZREJfSUNfUE9SVC50b1N0cmluZygpLFxuXHRcdFx0WURCX01PTl9QT1JUOiBZREJfTU9OX1BPUlQudG9TdHJpbmcoKSxcblx0XHRcdFlEQl9HUlBDX1BPUlQ6IFlEQl9HUlBDX1BPUlQudG9TdHJpbmcoKSxcblx0XHR9LFxuXHR9KS50b1N0cmluZygpXG59XG5cbmlmIChpbXBvcnQubWV0YS51cmwgPT09IG5ldyBVUkwoJy4vY29uZmlncy50cycsIGltcG9ydC5tZXRhLnVybCkuaHJlZikge1xuXHRjb25zb2xlLmxvZyhnZW5lcmF0ZUNvbXBvc2VGaWxlKDIpKVxufVxuIgogIF0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7OztBQUFBO0FBYU8sSUFBSSxzQkFBc0IsQ0FBQyx5QkFBaUM7QUFBQSxFQUNsRSxJQUFNLGFBQXVCLENBQUM7QUFBQSxFQUU5QixTQUFTLElBQUksRUFBRyxLQUFLLHNCQUFzQixLQUFLO0FBQUEsSUFDL0MsSUFBTSxXQUFXLGdCQUFnQixHQUMzQixVQUFVLGVBQWUsR0FDekIsU0FBUyxjQUFjLEdBQ3ZCLFdBQVcsd0JBQXdCO0FBQUEsSUFHekMsV0FBVyxLQUFLLEdBQUcsOENBQThDLEdBR2pFLFdBQVcsS0FBSyxHQUFHLDJDQUEyQyxJQUFJLEdBR2xFLFdBQVcsS0FBSyxJQUFJLGdFQUFnRSxXQUFXLEdBQy9GLFdBQVcsS0FBSyxJQUFJLCtEQUErRCxVQUFVLEdBQzdGLFdBQVcsS0FBSyxJQUFJLDhEQUE4RCxTQUFTLEdBRzNGLFdBQVcsS0FBSyxJQUFJLGtFQUFrRSxZQUFZLFdBQVcsR0FDN0csV0FBVyxLQUFLLElBQUksaUVBQWlFLFdBQVcsVUFBVSxHQUMxRyxXQUFXLEtBQUssSUFBSSxnRUFBZ0UsVUFBVSxTQUFTLEdBR3ZHLFdBQVcsS0FBSyxHQUFHLDZEQUE2RCxRQUFRLGNBQWM7QUFBQTtBQUFBLEVBSXZHLFdBQVcsS0FBSyx3Q0FBd0MsR0FHeEQsV0FBVyxLQUFLLHlEQUF5RDtBQUFBLEVBR3pFLElBQU0sVUFBVSxZQURDLFdBQVcsS0FBSyxLQUFLO0FBQUEsRUFHdEMsT0FBTyxTQUFTLFNBQVM7QUFBQSxJQUN4QixLQUFLO0FBQUEsU0FDRCxRQUFRO0FBQUEsTUFDWDtBQUFBLE1BQ0EsaUJBQWlCLGdCQUFnQixTQUFTO0FBQUEsTUFDMUMsNkJBQTZCLDRCQUE0QixTQUFTO0FBQUEsTUFDbEU7QUFBQSxNQUNBO0FBQUEsTUFDQSxhQUFhLFlBQVksU0FBUztBQUFBLE1BQ2xDLGNBQWMsYUFBYSxTQUFTO0FBQUEsTUFDcEMsZUFBZSxjQUFjLFNBQVM7QUFBQSxJQUN2QztBQUFBLEVBQ0QsQ0FBQyxFQUFFLFNBQVM7QUFBQTtBQUdiLElBQUksWUFBWSxRQUFRLElBQUksSUFBSSxnQkFBZ0IsWUFBWSxHQUFHLEVBQUU7QUFBQSxFQUNoRSxRQUFRLElBQUksb0JBQW9CLENBQUMsQ0FBQzsiLAogICJkZWJ1Z0lkIjogIkI5MjZBQzE3Njg5RTcyQ0Q2NDc1NkUyMTY0NzU2RTIxIiwKICAibmFtZXMiOiBbXQp9
