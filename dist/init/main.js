import {
  require_github
} from "../main-a65vejt4.js";
import {
  __toESM,
  require_core,
  require_exec
} from "../main-t8kwkc9h.js";

// init/main.ts
var import_core2 = __toESM(require_core(), 1), import_exec = __toESM(require_exec(), 1);
import * as fs from "node:fs";
import * as path from "node:path";
import { fileURLToPath } from "node:url";

// init/pulls.ts
var import_core = __toESM(require_core(), 1), import_github = __toESM(require_github(), 1);
async function getPullRequestNumber() {
  let token = import_core.getInput("github_token") || process.env.GITHUB_TOKEN, prNumber = import_core.getInput("github_pull_request_number");
  if (prNumber.length > 0)
    return parseInt(prNumber);
  if (import_github.context.eventName === "pull_request")
    return import_github.context.payload.pull_request.number;
  if (token) {
    let octokit = import_github.getOctokit(token), branch = import_github.context.ref.replace("refs/heads/", ""), { data: pulls } = await octokit.rest.pulls.list({
      state: "open",
      owner: import_github.context.repo.owner,
      repo: import_github.context.repo.repo,
      head: `${import_github.context.actor}:${branch}`
    });
    if (pulls.length > 0)
      return pulls[0].number;
  }
  return null;
}

// init/main.ts
async function main() {
  let cwd = path.join(process.cwd(), ".slo"), workload = import_core2.getInput("workload_name") || "unspecified";
  import_core2.saveState("cwd", cwd), import_core2.saveState("workload", workload), fs.mkdirSync(cwd, { recursive: !0 });
  let prNumber = await getPullRequestNumber();
  if (!prNumber) {
    import_core2.setFailed("Pull request number not found");
    return;
  }
  import_core2.saveState("pull", prNumber);
  {
    let pullPath = path.join(cwd, `${workload}-pull.txt`);
    import_core2.saveState("pull_info_path", pullPath), fs.writeFileSync(pullPath, prNumber.toFixed(0), { encoding: "utf-8" }), import_core2.debug(`Pull request information saved to ${pullPath}`);
  }
  {
    let actionRoot = path.resolve(path.dirname(fileURLToPath(import.meta.url)), "../../"), deployPath = path.join(actionRoot, "deploy");
    if (!fs.existsSync(deployPath)) {
      import_core2.setFailed(`Deploy assets not found at ${deployPath}`);
      return;
    }
    for (let entry of fs.readdirSync(deployPath)) {
      let src = path.join(deployPath, entry), dest = path.join(cwd, entry);
      fs.cpSync(src, dest, { recursive: !0 });
    }
    import_core2.debug(`Deploy assets copied to ${cwd}`), import_core2.debug(`Deploy assets: ${fs.readdirSync(cwd)}`);
  }
  {
    let metricsFilePath = path.join(cwd, "metrics.jsonl");
    import_core2.saveState("telemetry_metrics_file", metricsFilePath), fs.writeFileSync(metricsFilePath, "", { encoding: "utf-8" }), import_core2.debug(`Telemetry metrics file: ${metricsFilePath}`);
  }
  await import_exec.exec("docker", ["compose", "-f", "compose.yml", "up", "--quiet-pull", "-d"], { cwd });
  let start = /* @__PURE__ */ new Date;
  import_core2.info(`YDB started at ${start}`), import_core2.saveState("start", start.toISOString());
}
main();

//# debugId=7225A883A7E87E6A64756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vaW5pdC9tYWluLnRzIiwgIi4uL2luaXQvcHVsbHMudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbCiAgICAiaW1wb3J0ICogYXMgZnMgZnJvbSAnbm9kZTpmcydcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAnbm9kZTpwYXRoJ1xuaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCB9IGZyb20gJ25vZGU6dXJsJ1xuXG5pbXBvcnQgeyBkZWJ1ZywgZ2V0SW5wdXQsIGluZm8sIHNhdmVTdGF0ZSwgc2V0RmFpbGVkIH0gZnJvbSAnQGFjdGlvbnMvY29yZSdcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICdAYWN0aW9ucy9leGVjJ1xuXG5pbXBvcnQgeyBnZXRQdWxsUmVxdWVzdE51bWJlciB9IGZyb20gJy4vcHVsbHMuanMnXG5cbmFzeW5jIGZ1bmN0aW9uIG1haW4oKSB7XG5cdGxldCBjd2QgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5zbG8nKVxuXHRsZXQgd29ya2xvYWQgPSBnZXRJbnB1dCgnd29ya2xvYWRfbmFtZScpIHx8ICd1bnNwZWNpZmllZCdcblxuXHRzYXZlU3RhdGUoJ2N3ZCcsIGN3ZClcblx0c2F2ZVN0YXRlKCd3b3JrbG9hZCcsIHdvcmtsb2FkKVxuXG5cdC8qKlxuXHQgKiBQcmVwYXJlIHdvcmtpbmcgZGlyZWN0b3J5XG5cdCAqL1xuXHR7XG5cdFx0ZnMubWtkaXJTeW5jKGN3ZCwgeyByZWN1cnNpdmU6IHRydWUgfSlcblx0fVxuXG5cdGxldCBwck51bWJlciA9IGF3YWl0IGdldFB1bGxSZXF1ZXN0TnVtYmVyKClcblx0aWYgKCFwck51bWJlcikge1xuXHRcdHNldEZhaWxlZCgnUHVsbCByZXF1ZXN0IG51bWJlciBub3QgZm91bmQnKVxuXHRcdHJldHVyblxuXHR9XG5cblx0c2F2ZVN0YXRlKCdwdWxsJywgcHJOdW1iZXIpXG5cblx0LyoqXG5cdCAqIFByZXBhcmUgcHVsbCByZXF1ZXN0IGluZm9ybWF0aW9uXG5cdCAqL1xuXHR7XG5cdFx0bGV0IHB1bGxQYXRoID0gcGF0aC5qb2luKGN3ZCwgYCR7d29ya2xvYWR9LXB1bGwudHh0YClcblx0XHRzYXZlU3RhdGUoJ3B1bGxfaW5mb19wYXRoJywgcHVsbFBhdGgpXG5cdFx0ZnMud3JpdGVGaWxlU3luYyhwdWxsUGF0aCwgcHJOdW1iZXIudG9GaXhlZCgwKSwgeyBlbmNvZGluZzogJ3V0Zi04JyB9KVxuXG5cdFx0ZGVidWcoYFB1bGwgcmVxdWVzdCBpbmZvcm1hdGlvbiBzYXZlZCB0byAke3B1bGxQYXRofWApXG5cdH1cblxuXHQvKipcblx0ICogQ29weSBkZXBsb3kgYXNzZXRzXG5cdCAqL1xuXHR7XG5cdFx0Y29uc3QgYWN0aW9uUm9vdCA9IHBhdGgucmVzb2x2ZShwYXRoLmRpcm5hbWUoZmlsZVVSTFRvUGF0aChpbXBvcnQubWV0YS51cmwpKSwgJy4uLy4uLycpXG5cdFx0Y29uc3QgZGVwbG95UGF0aCA9IHBhdGguam9pbihhY3Rpb25Sb290LCAnZGVwbG95JylcblxuXHRcdGlmICghZnMuZXhpc3RzU3luYyhkZXBsb3lQYXRoKSkge1xuXHRcdFx0c2V0RmFpbGVkKGBEZXBsb3kgYXNzZXRzIG5vdCBmb3VuZCBhdCAke2RlcGxveVBhdGh9YClcblx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdGZvciAobGV0IGVudHJ5IG9mIGZzLnJlYWRkaXJTeW5jKGRlcGxveVBhdGgpKSB7XG5cdFx0XHRsZXQgc3JjID0gcGF0aC5qb2luKGRlcGxveVBhdGgsIGVudHJ5KVxuXHRcdFx0bGV0IGRlc3QgPSBwYXRoLmpvaW4oY3dkLCBlbnRyeSlcblx0XHRcdGZzLmNwU3luYyhzcmMsIGRlc3QsIHsgcmVjdXJzaXZlOiB0cnVlIH0pXG5cdFx0fVxuXG5cdFx0ZGVidWcoYERlcGxveSBhc3NldHMgY29waWVkIHRvICR7Y3dkfWApXG5cdFx0ZGVidWcoYERlcGxveSBhc3NldHM6ICR7ZnMucmVhZGRpclN5bmMoY3dkKX1gKVxuXHR9XG5cblx0LyoqXG5cdCAqIFByZXBhcmUgdGVsZW1ldHJ5IG1ldHJpY3MgZmlsZVxuXHQgKi9cblx0e1xuXHRcdGxldCBtZXRyaWNzRmlsZVBhdGggPSBwYXRoLmpvaW4oY3dkLCAnbWV0cmljcy5qc29ubCcpXG5cdFx0c2F2ZVN0YXRlKCd0ZWxlbWV0cnlfbWV0cmljc19maWxlJywgbWV0cmljc0ZpbGVQYXRoKVxuXHRcdGZzLndyaXRlRmlsZVN5bmMobWV0cmljc0ZpbGVQYXRoLCAnJywgeyBlbmNvZGluZzogJ3V0Zi04JyB9KVxuXG5cdFx0ZGVidWcoYFRlbGVtZXRyeSBtZXRyaWNzIGZpbGU6ICR7bWV0cmljc0ZpbGVQYXRofWApXG5cdH1cblxuXHQvKipcblx0ICogU3RhcnQgWURCIHNlcnZpY2VzXG5cdCAqL1xuXHR7XG5cdFx0YXdhaXQgZXhlYyhgZG9ja2VyYCwgW2Bjb21wb3NlYCwgYC1mYCwgYGNvbXBvc2UueW1sYCwgYHVwYCwgYC0tcXVpZXQtcHVsbGAsIGAtZGBdLCB7IGN3ZCB9KVxuXHR9XG5cblx0bGV0IHN0YXJ0ID0gbmV3IERhdGUoKVxuXHRpbmZvKGBZREIgc3RhcnRlZCBhdCAke3N0YXJ0fWApXG5cdHNhdmVTdGF0ZSgnc3RhcnQnLCBzdGFydC50b0lTT1N0cmluZygpKVxufVxuXG5tYWluKClcbiIsCiAgICAiaW1wb3J0IHsgZ2V0SW5wdXQgfSBmcm9tICdAYWN0aW9ucy9jb3JlJ1xuaW1wb3J0IHsgY29udGV4dCwgZ2V0T2N0b2tpdCB9IGZyb20gJ0BhY3Rpb25zL2dpdGh1YidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFB1bGxSZXF1ZXN0TnVtYmVyKCkge1xuXHRsZXQgdG9rZW4gPSBnZXRJbnB1dCgnZ2l0aHViX3Rva2VuJykgfHwgcHJvY2Vzcy5lbnYuR0lUSFVCX1RPS0VOXG5cblx0bGV0IHByTnVtYmVyID0gZ2V0SW5wdXQoJ2dpdGh1Yl9wdWxsX3JlcXVlc3RfbnVtYmVyJylcblx0aWYgKHByTnVtYmVyLmxlbmd0aCA+IDApIHtcblx0XHRyZXR1cm4gcGFyc2VJbnQocHJOdW1iZXIpXG5cdH1cblxuXHRpZiAoY29udGV4dC5ldmVudE5hbWUgPT09ICdwdWxsX3JlcXVlc3QnKSB7XG5cdFx0cmV0dXJuIGNvbnRleHQucGF5bG9hZC5wdWxsX3JlcXVlc3QhLm51bWJlclxuXHR9XG5cblx0aWYgKHRva2VuKSB7XG5cdFx0bGV0IG9jdG9raXQgPSBnZXRPY3Rva2l0KHRva2VuKVxuXHRcdGxldCBicmFuY2ggPSBjb250ZXh0LnJlZi5yZXBsYWNlKCdyZWZzL2hlYWRzLycsICcnKVxuXG5cdFx0Y29uc3QgeyBkYXRhOiBwdWxscyB9ID0gYXdhaXQgb2N0b2tpdC5yZXN0LnB1bGxzLmxpc3Qoe1xuXHRcdFx0c3RhdGU6ICdvcGVuJyxcblx0XHRcdG93bmVyOiBjb250ZXh0LnJlcG8ub3duZXIsXG5cdFx0XHRyZXBvOiBjb250ZXh0LnJlcG8ucmVwbyxcblx0XHRcdGhlYWQ6IGAke2NvbnRleHQuYWN0b3J9OiR7YnJhbmNofWAsXG5cdFx0fSlcblxuXHRcdGlmIChwdWxscy5sZW5ndGggPiAwKSB7XG5cdFx0XHRyZXR1cm4gcHVsbHNbMF0ubnVtYmVyXG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIG51bGxcbn1cbiIKICBdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7QUFJQSwrQ0FDQTtBQUxBO0FBQ0E7QUFDQTs7O0FDRkEsOENBQ0E7QUFFQSxlQUFzQixvQkFBb0IsR0FBRztBQUFBLEVBQzVDLElBQUksUUFBUSxxQkFBUyxjQUFjLEtBQUssUUFBUSxJQUFJLGNBRWhELFdBQVcscUJBQVMsNEJBQTRCO0FBQUEsRUFDcEQsSUFBSSxTQUFTLFNBQVM7QUFBQSxJQUNyQixPQUFPLFNBQVMsUUFBUTtBQUFBLEVBR3pCLElBQUksc0JBQVEsY0FBYztBQUFBLElBQ3pCLE9BQU8sc0JBQVEsUUFBUSxhQUFjO0FBQUEsRUFHdEMsSUFBSSxPQUFPO0FBQUEsSUFDVixJQUFJLFVBQVUseUJBQVcsS0FBSyxHQUMxQixTQUFTLHNCQUFRLElBQUksUUFBUSxlQUFlLEVBQUUsS0FFMUMsTUFBTSxVQUFVLE1BQU0sUUFBUSxLQUFLLE1BQU0sS0FBSztBQUFBLE1BQ3JELE9BQU87QUFBQSxNQUNQLE9BQU8sc0JBQVEsS0FBSztBQUFBLE1BQ3BCLE1BQU0sc0JBQVEsS0FBSztBQUFBLE1BQ25CLE1BQU0sR0FBRyxzQkFBUSxTQUFTO0FBQUEsSUFDM0IsQ0FBQztBQUFBLElBRUQsSUFBSSxNQUFNLFNBQVM7QUFBQSxNQUNsQixPQUFPLE1BQU0sR0FBRztBQUFBO0FBQUEsRUFJbEIsT0FBTztBQUFBOzs7QUR0QlIsZUFBZSxJQUFJLEdBQUc7QUFBQSxFQUNyQixJQUFJLE1BQVcsVUFBSyxRQUFRLElBQUksR0FBRyxNQUFNLEdBQ3JDLFdBQVcsc0JBQVMsZUFBZSxLQUFLO0FBQUEsRUFFNUMsdUJBQVUsT0FBTyxHQUFHLEdBQ3BCLHVCQUFVLFlBQVksUUFBUSxHQU0xQixhQUFVLEtBQUssRUFBRSxXQUFXLEdBQUssQ0FBQztBQUFBLEVBR3RDLElBQUksV0FBVyxNQUFNLHFCQUFxQjtBQUFBLEVBQzFDLElBQUksQ0FBQyxVQUFVO0FBQUEsSUFDZCx1QkFBVSwrQkFBK0I7QUFBQSxJQUN6QztBQUFBO0FBQUEsRUFHRCx1QkFBVSxRQUFRLFFBQVE7QUFBQSxFQUsxQjtBQUFBLElBQ0MsSUFBSSxXQUFnQixVQUFLLEtBQUssR0FBRyxtQkFBbUI7QUFBQSxJQUNwRCx1QkFBVSxrQkFBa0IsUUFBUSxHQUNqQyxpQkFBYyxVQUFVLFNBQVMsUUFBUSxDQUFDLEdBQUcsRUFBRSxVQUFVLFFBQVEsQ0FBQyxHQUVyRSxtQkFBTSxxQ0FBcUMsVUFBVTtBQUFBLEVBQ3REO0FBQUEsRUFLQTtBQUFBLElBQ0MsSUFBTSxhQUFrQixhQUFhLGFBQVEsY0FBYyxZQUFZLEdBQUcsQ0FBQyxHQUFHLFFBQVEsR0FDaEYsYUFBa0IsVUFBSyxZQUFZLFFBQVE7QUFBQSxJQUVqRCxJQUFJLENBQUksY0FBVyxVQUFVLEdBQUc7QUFBQSxNQUMvQix1QkFBVSw4QkFBOEIsWUFBWTtBQUFBLE1BQ3BEO0FBQUE7QUFBQSxJQUdELFNBQVMsU0FBWSxlQUFZLFVBQVUsR0FBRztBQUFBLE1BQzdDLElBQUksTUFBVyxVQUFLLFlBQVksS0FBSyxHQUNqQyxPQUFZLFVBQUssS0FBSyxLQUFLO0FBQUEsTUFDNUIsVUFBTyxLQUFLLE1BQU0sRUFBRSxXQUFXLEdBQUssQ0FBQztBQUFBO0FBQUEsSUFHekMsbUJBQU0sMkJBQTJCLEtBQUssR0FDdEMsbUJBQU0sa0JBQXFCLGVBQVksR0FBRyxHQUFHO0FBQUEsRUFDOUM7QUFBQSxFQUtBO0FBQUEsSUFDQyxJQUFJLGtCQUF1QixVQUFLLEtBQUssZUFBZTtBQUFBLElBQ3BELHVCQUFVLDBCQUEwQixlQUFlLEdBQ2hELGlCQUFjLGlCQUFpQixJQUFJLEVBQUUsVUFBVSxRQUFRLENBQUMsR0FFM0QsbUJBQU0sMkJBQTJCLGlCQUFpQjtBQUFBLEVBQ25EO0FBQUEsRUFNQyxNQUFNLGlCQUFLLFVBQVUsQ0FBQyxXQUFXLE1BQU0sZUFBZSxNQUFNLGdCQUFnQixJQUFJLEdBQUcsRUFBRSxJQUFJLENBQUM7QUFBQSxFQUczRixJQUFJLHdCQUFRLElBQUk7QUFBQSxFQUNoQixrQkFBSyxrQkFBa0IsT0FBTyxHQUM5Qix1QkFBVSxTQUFTLE1BQU0sWUFBWSxDQUFDO0FBQUE7QUFHdkMsS0FBSzsiLAogICJkZWJ1Z0lkIjogIjcyMjVBODgzQTdFODdFNkE2NDc1NkUyMTY0NzU2RTIxIiwKICAibmFtZXMiOiBbXQp9
