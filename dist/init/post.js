import {
  __toESM,
  require_artifact,
  require_core,
  require_exec
} from "../main-h27v9fgs.js";

// init/post.ts
var import_artifact = __toESM(require_artifact(), 1), import_core = __toESM(require_core(), 1), import_exec = __toESM(require_exec(), 1);
import * as fs from "node:fs";
import * as path from "node:path";
async function post() {
  let cwd = import_core.getState("cwd"), workload = import_core.getState("workload"), start = new Date(import_core.getState("start")), duration = (/* @__PURE__ */ new Date()).getTime() - start.getTime();
  await import_exec.exec("docker", ["compose", "-f", "compose.yml", "down"], { cwd });
  let metricsFilePath = import_core.getState("telemetry_metrics_file") || path.join(cwd, "metrics.jsonl");
  if (fs.existsSync(metricsFilePath)) {
    let artifactClient = new import_artifact.DefaultArtifactClient, { id } = await artifactClient.uploadArtifact(`${workload}-metrics.jsonl`, [metricsFilePath], cwd, {
      retentionDays: 1
    });
    import_core.debug(`Metrics artifact id: ${id}`);
  } else
    import_core.warning(`Metrics file not found at ${metricsFilePath}`);
  {
    fs.rmSync(cwd, { recursive: !0 }), import_core.debug(`Removed .slo workspace: ${cwd}`);
    let seconds = (duration / 1000).toFixed(1);
    import_core.info(`YDB SLO Test duration: ${seconds}s`);
  }
}
post();

//# debugId=1BA8E76D5259B54464756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vaW5pdC9wb3N0LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgImltcG9ydCAqIGFzIGZzIGZyb20gJ25vZGU6ZnMnXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ25vZGU6cGF0aCdcblxuaW1wb3J0IHsgRGVmYXVsdEFydGlmYWN0Q2xpZW50IH0gZnJvbSAnQGFjdGlvbnMvYXJ0aWZhY3QnXG5pbXBvcnQgeyBkZWJ1ZywgZ2V0U3RhdGUsIGluZm8sIHdhcm5pbmcgfSBmcm9tICdAYWN0aW9ucy9jb3JlJ1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ0BhY3Rpb25zL2V4ZWMnXG5cbmFzeW5jIGZ1bmN0aW9uIHBvc3QoKSB7XG5cdGxldCBjd2QgPSBnZXRTdGF0ZSgnY3dkJylcblx0bGV0IHdvcmtsb2FkID0gZ2V0U3RhdGUoJ3dvcmtsb2FkJylcblxuXHRsZXQgc3RhcnQgPSBuZXcgRGF0ZShnZXRTdGF0ZSgnc3RhcnQnKSlcblx0bGV0IGZpbmlzaCA9IG5ldyBEYXRlKClcblx0bGV0IGR1cmF0aW9uID0gZmluaXNoLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKVxuXG5cdC8qKlxuXHQgKiBTdG9wIGRvY2tlciBjb21wb3NlXG5cdCAqL1xuXHR7XG5cdFx0YXdhaXQgZXhlYyhgZG9ja2VyYCwgW2Bjb21wb3NlYCwgYC1mYCwgYGNvbXBvc2UueW1sYCwgYGRvd25gXSwgeyBjd2QgfSlcblx0fVxuXG5cdGxldCBtZXRyaWNzRmlsZVBhdGggPSBnZXRTdGF0ZSgndGVsZW1ldHJ5X21ldHJpY3NfZmlsZScpIHx8IHBhdGguam9pbihjd2QsICdtZXRyaWNzLmpzb25sJylcblxuXHQvKipcblx0ICogUGVyc2lzdCB0ZWxlbWV0cnkgbWV0cmljc1xuXHQgKi9cblx0e1xuXHRcdGlmIChmcy5leGlzdHNTeW5jKG1ldHJpY3NGaWxlUGF0aCkpIHtcblx0XHRcdGxldCBhcnRpZmFjdENsaWVudCA9IG5ldyBEZWZhdWx0QXJ0aWZhY3RDbGllbnQoKVxuXHRcdFx0bGV0IHsgaWQgfSA9IGF3YWl0IGFydGlmYWN0Q2xpZW50LnVwbG9hZEFydGlmYWN0KGAke3dvcmtsb2FkfS1tZXRyaWNzLmpzb25sYCwgW21ldHJpY3NGaWxlUGF0aF0sIGN3ZCwge1xuXHRcdFx0XHRyZXRlbnRpb25EYXlzOiAxLFxuXHRcdFx0fSlcblxuXHRcdFx0ZGVidWcoYE1ldHJpY3MgYXJ0aWZhY3QgaWQ6ICR7aWR9YClcblx0XHR9IGVsc2Uge1xuXHRcdFx0d2FybmluZyhgTWV0cmljcyBmaWxlIG5vdCBmb3VuZCBhdCAke21ldHJpY3NGaWxlUGF0aH1gKVxuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDbGVhbnVwXG5cdCAqL1xuXHR7XG5cdFx0ZnMucm1TeW5jKGN3ZCwgeyByZWN1cnNpdmU6IHRydWUgfSlcblx0XHRkZWJ1ZyhgUmVtb3ZlZCAuc2xvIHdvcmtzcGFjZTogJHtjd2R9YClcblxuXHRcdGxldCBzZWNvbmRzID0gKGR1cmF0aW9uIC8gMTAwMCkudG9GaXhlZCgxKVxuXHRcdGluZm8oYFlEQiBTTE8gVGVzdCBkdXJhdGlvbjogJHtzZWNvbmRzfXNgKVxuXHR9XG59XG5cbnBvc3QoKVxuIgogIF0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7QUFHQSxzREFDQSwwQ0FDQTtBQUxBO0FBQ0E7QUFNQSxlQUFlLElBQUksR0FBRztBQUFBLEVBQ3JCLElBQUksTUFBTSxxQkFBUyxLQUFLLEdBQ3BCLFdBQVcscUJBQVMsVUFBVSxHQUU5QixRQUFRLElBQUksS0FBSyxxQkFBUyxPQUFPLENBQUMsR0FFbEMsNEJBRFMsSUFBSSxLQUFLLEdBQ0EsUUFBUSxJQUFJLE1BQU0sUUFBUTtBQUFBLEVBTS9DLE1BQU0saUJBQUssVUFBVSxDQUFDLFdBQVcsTUFBTSxlQUFlLE1BQU0sR0FBRyxFQUFFLElBQUksQ0FBQztBQUFBLEVBR3ZFLElBQUksa0JBQWtCLHFCQUFTLHdCQUF3QixLQUFVLFVBQUssS0FBSyxlQUFlO0FBQUEsRUFNekYsSUFBTyxjQUFXLGVBQWUsR0FBRztBQUFBLElBQ25DLElBQUksaUJBQWlCLElBQUkseUNBQ25CLE9BQU8sTUFBTSxlQUFlLGVBQWUsR0FBRywwQkFBMEIsQ0FBQyxlQUFlLEdBQUcsS0FBSztBQUFBLE1BQ3JHLGVBQWU7QUFBQSxJQUNoQixDQUFDO0FBQUEsSUFFRCxrQkFBTSx3QkFBd0IsSUFBSTtBQUFBLElBRWxDO0FBQUEsd0JBQVEsNkJBQTZCLGlCQUFpQjtBQUFBLEVBT3hEO0FBQUEsSUFDSSxVQUFPLEtBQUssRUFBRSxXQUFXLEdBQUssQ0FBQyxHQUNsQyxrQkFBTSwyQkFBMkIsS0FBSztBQUFBLElBRXRDLElBQUksV0FBVyxXQUFXLE1BQU0sUUFBUSxDQUFDO0FBQUEsSUFDekMsaUJBQUssMEJBQTBCLFVBQVU7QUFBQSxFQUMxQztBQUFBO0FBR0QsS0FBSzsiLAogICJkZWJ1Z0lkIjogIjFCQThFNzZENTI1OUI1NDQ2NDc1NkUyMTY0NzU2RTIxIiwKICAibmFtZXMiOiBbXQp9
