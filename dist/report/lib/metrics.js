import"../../main-ynsbc1hx.js";

// report/lib/metrics.ts
function parseMetricsJsonl(content) {
  let metrics = /* @__PURE__ */ new Map, lines = content.trim().split(`
`);
  for (let line of lines) {
    if (!line.trim())
      continue;
    try {
      let metric = JSON.parse(line);
      metrics.set(metric.name, metric);
    } catch {
      continue;
    }
  }
  return metrics;
}
function separateByRef(metric) {
  let current = null, base = null;
  if (metric.type === "instant") {
    let data = metric.data;
    current = data.find((s) => s.metric.ref === "current") || null, base = data.find((s) => s.metric.ref === "base") || null;
  } else {
    let data = metric.data;
    current = data.find((s) => s.metric.ref === "current") || null, base = data.find((s) => s.metric.ref === "base") || null;
  }
  return { current, base };
}
function percentile(values, p) {
  let sorted = [...values].sort((a, b) => a - b), index = Math.ceil(sorted.length * p) - 1;
  return sorted[Math.max(0, index)];
}
function aggregateValues(values, fn) {
  if (values.length === 0)
    return NaN;
  let nums = values.map(([_, v]) => parseFloat(v)).filter((n) => !isNaN(n));
  if (nums.length === 0)
    return NaN;
  switch (fn) {
    case "last":
      return nums[nums.length - 1];
    case "first":
      return nums[0];
    case "avg":
      return nums.reduce((a, b) => a + b, 0) / nums.length;
    case "min":
      return Math.min(...nums);
    case "max":
      return Math.max(...nums);
    case "p50":
      return percentile(nums, 0.5);
    case "p95":
      return percentile(nums, 0.95);
    case "p99":
      return percentile(nums, 0.99);
    case "sum":
      return nums.reduce((a, b) => a + b, 0);
    case "count":
      return nums.length;
    default:
      return NaN;
  }
}
function getMetricValue(metric, ref, aggregate = "avg") {
  let separated = separateByRef(metric), series = ref === "current" ? separated.current : separated.base;
  if (!series)
    return NaN;
  if (metric.type === "instant")
    return parseFloat(series.value[1]);
  else
    return aggregateValues(series.values, aggregate);
}
export {
  separateByRef,
  parseMetricsJsonl,
  getMetricValue,
  aggregateValues
};

export { parseMetricsJsonl, getMetricValue };

//# debugId=BDC17CEB417C91CE64756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vcmVwb3J0L2xpYi9tZXRyaWNzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgIi8qKlxuICogTWV0cmljcyBwYXJzaW5nIGFuZCB0eXBlcyBmb3IgcmVwb3J0IGFjdGlvblxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VyaWVzIHtcblx0bWV0cmljOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG5cdHZhbHVlczogW251bWJlciwgc3RyaW5nXVtdIC8vIFt0aW1lc3RhbXAgKHNlYyksIHZhbHVlIChmbG9hdCldXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5zdGFudFNlcmllcyB7XG5cdG1ldHJpYzogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxuXHR2YWx1ZTogW251bWJlciwgc3RyaW5nXSAvLyBbdGltZXN0YW1wIChzZWMpLCB2YWx1ZSAoZmxvYXQpXVxufVxuXG4vKipcbiAqIENvbGxlY3RlZCBtZXRyaWMgZnJvbSBpbml0IGFjdGlvbiAoSlNPTkwgZm9ybWF0KVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbGxlY3RlZE1ldHJpYyB7XG5cdG5hbWU6IHN0cmluZ1xuXHRxdWVyeTogc3RyaW5nXG5cdHR5cGU6ICdyYW5nZScgfCAnaW5zdGFudCdcblx0ZGF0YTogU2VyaWVzW10gfCBJbnN0YW50U2VyaWVzW11cbn1cblxuLyoqXG4gKiBQYXJzZWQgbWV0cmljcyBieSBuYW1lXG4gKi9cbmV4cG9ydCB0eXBlIE1ldHJpY3NNYXAgPSBNYXA8c3RyaW5nLCBDb2xsZWN0ZWRNZXRyaWM+XG5cbi8qKlxuICogUGFyc2UgSlNPTkwgbWV0cmljcyBmaWxlIGludG8gTWV0cmljc01hcFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VNZXRyaWNzSnNvbmwoY29udGVudDogc3RyaW5nKTogTWV0cmljc01hcCB7XG5cdGxldCBtZXRyaWNzID0gbmV3IE1hcDxzdHJpbmcsIENvbGxlY3RlZE1ldHJpYz4oKVxuXHRsZXQgbGluZXMgPSBjb250ZW50LnRyaW0oKS5zcGxpdCgnXFxuJylcblxuXHRmb3IgKGxldCBsaW5lIG9mIGxpbmVzKSB7XG5cdFx0aWYgKCFsaW5lLnRyaW0oKSkgY29udGludWVcblxuXHRcdHRyeSB7XG5cdFx0XHRsZXQgbWV0cmljID0gSlNPTi5wYXJzZShsaW5lKSBhcyBDb2xsZWN0ZWRNZXRyaWNcblx0XHRcdG1ldHJpY3Muc2V0KG1ldHJpYy5uYW1lLCBtZXRyaWMpXG5cdFx0fSBjYXRjaCB7XG5cdFx0XHQvLyBTa2lwIGludmFsaWQgbGluZXNcblx0XHRcdGNvbnRpbnVlXG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIG1ldHJpY3Ncbn1cblxuLyoqXG4gKiBTZXBhcmF0ZSBzZXJpZXMgYnkgcmVmIGxhYmVsIChjdXJyZW50IHZzIGJhc2UpXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VwYXJhdGVkU2VyaWVzIHtcblx0Y3VycmVudDogU2VyaWVzIHwgSW5zdGFudFNlcmllcyB8IG51bGxcblx0YmFzZTogU2VyaWVzIHwgSW5zdGFudFNlcmllcyB8IG51bGxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlcGFyYXRlQnlSZWYobWV0cmljOiBDb2xsZWN0ZWRNZXRyaWMpOiBTZXBhcmF0ZWRTZXJpZXMge1xuXHRsZXQgY3VycmVudDogU2VyaWVzIHwgSW5zdGFudFNlcmllcyB8IG51bGwgPSBudWxsXG5cdGxldCBiYXNlOiBTZXJpZXMgfCBJbnN0YW50U2VyaWVzIHwgbnVsbCA9IG51bGxcblxuXHRpZiAobWV0cmljLnR5cGUgPT09ICdpbnN0YW50Jykge1xuXHRcdGxldCBkYXRhID0gbWV0cmljLmRhdGEgYXMgSW5zdGFudFNlcmllc1tdXG5cdFx0Y3VycmVudCA9IGRhdGEuZmluZCgocykgPT4gcy5tZXRyaWMucmVmID09PSAnY3VycmVudCcpIHx8IG51bGxcblx0XHRiYXNlID0gZGF0YS5maW5kKChzKSA9PiBzLm1ldHJpYy5yZWYgPT09ICdiYXNlJykgfHwgbnVsbFxuXHR9IGVsc2Uge1xuXHRcdGxldCBkYXRhID0gbWV0cmljLmRhdGEgYXMgU2VyaWVzW11cblx0XHRjdXJyZW50ID0gZGF0YS5maW5kKChzKSA9PiBzLm1ldHJpYy5yZWYgPT09ICdjdXJyZW50JykgfHwgbnVsbFxuXHRcdGJhc2UgPSBkYXRhLmZpbmQoKHMpID0+IHMubWV0cmljLnJlZiA9PT0gJ2Jhc2UnKSB8fCBudWxsXG5cdH1cblxuXHRyZXR1cm4geyBjdXJyZW50LCBiYXNlIH1cbn1cblxuLyoqXG4gKiBBZ2dyZWdhdGUgZnVuY3Rpb24gdHlwZSBmb3IgcmFuZ2UgbWV0cmljc1xuICovXG5leHBvcnQgdHlwZSBBZ2dyZWdhdGVGdW5jdGlvbiA9ICdsYXN0JyB8ICdmaXJzdCcgfCAnYXZnJyB8ICdtaW4nIHwgJ21heCcgfCAncDUwJyB8ICdwOTUnIHwgJ3A5OScgfCAnc3VtJyB8ICdjb3VudCdcblxuLyoqXG4gKiBDYWxjdWxhdGUgcGVyY2VudGlsZVxuICovXG5mdW5jdGlvbiBwZXJjZW50aWxlKHZhbHVlczogbnVtYmVyW10sIHA6IG51bWJlcik6IG51bWJlciB7XG5cdGxldCBzb3J0ZWQgPSBbLi4udmFsdWVzXS5zb3J0KChhLCBiKSA9PiBhIC0gYilcblx0bGV0IGluZGV4ID0gTWF0aC5jZWlsKHNvcnRlZC5sZW5ndGggKiBwKSAtIDFcblx0cmV0dXJuIHNvcnRlZFtNYXRoLm1heCgwLCBpbmRleCldXG59XG5cbi8qKlxuICogQWdncmVnYXRlIHJhbmdlIG1ldHJpYyB2YWx1ZXMgdXNpbmcgc3BlY2lmaWVkIGZ1bmN0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhZ2dyZWdhdGVWYWx1ZXModmFsdWVzOiBbbnVtYmVyLCBzdHJpbmddW10sIGZuOiBBZ2dyZWdhdGVGdW5jdGlvbik6IG51bWJlciB7XG5cdGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSByZXR1cm4gTmFOXG5cblx0bGV0IG51bXMgPSB2YWx1ZXMubWFwKChbXywgdl0pID0+IHBhcnNlRmxvYXQodikpLmZpbHRlcigobikgPT4gIWlzTmFOKG4pKVxuXG5cdGlmIChudW1zLmxlbmd0aCA9PT0gMCkgcmV0dXJuIE5hTlxuXG5cdHN3aXRjaCAoZm4pIHtcblx0XHRjYXNlICdsYXN0Jzpcblx0XHRcdHJldHVybiBudW1zW251bXMubGVuZ3RoIC0gMV1cblx0XHRjYXNlICdmaXJzdCc6XG5cdFx0XHRyZXR1cm4gbnVtc1swXVxuXHRcdGNhc2UgJ2F2Zyc6XG5cdFx0XHRyZXR1cm4gbnVtcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIG51bXMubGVuZ3RoXG5cdFx0Y2FzZSAnbWluJzpcblx0XHRcdHJldHVybiBNYXRoLm1pbiguLi5udW1zKVxuXHRcdGNhc2UgJ21heCc6XG5cdFx0XHRyZXR1cm4gTWF0aC5tYXgoLi4ubnVtcylcblx0XHRjYXNlICdwNTAnOlxuXHRcdFx0cmV0dXJuIHBlcmNlbnRpbGUobnVtcywgMC41KVxuXHRcdGNhc2UgJ3A5NSc6XG5cdFx0XHRyZXR1cm4gcGVyY2VudGlsZShudW1zLCAwLjk1KVxuXHRcdGNhc2UgJ3A5OSc6XG5cdFx0XHRyZXR1cm4gcGVyY2VudGlsZShudW1zLCAwLjk5KVxuXHRcdGNhc2UgJ3N1bSc6XG5cdFx0XHRyZXR1cm4gbnVtcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKVxuXHRcdGNhc2UgJ2NvdW50Jzpcblx0XHRcdHJldHVybiBudW1zLmxlbmd0aFxuXHRcdGRlZmF1bHQ6XG5cdFx0XHRyZXR1cm4gTmFOXG5cdH1cbn1cblxuLyoqXG4gKiBHZXQgc2luZ2xlIHZhbHVlIGZyb20gbWV0cmljIChpbnN0YW50IG9yIGFnZ3JlZ2F0ZWQgcmFuZ2UpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNZXRyaWNWYWx1ZShcblx0bWV0cmljOiBDb2xsZWN0ZWRNZXRyaWMsXG5cdHJlZjogJ2N1cnJlbnQnIHwgJ2Jhc2UnLFxuXHRhZ2dyZWdhdGU6IEFnZ3JlZ2F0ZUZ1bmN0aW9uID0gJ2F2Zydcbik6IG51bWJlciB7XG5cdGxldCBzZXBhcmF0ZWQgPSBzZXBhcmF0ZUJ5UmVmKG1ldHJpYylcblx0bGV0IHNlcmllcyA9IHJlZiA9PT0gJ2N1cnJlbnQnID8gc2VwYXJhdGVkLmN1cnJlbnQgOiBzZXBhcmF0ZWQuYmFzZVxuXG5cdGlmICghc2VyaWVzKSByZXR1cm4gTmFOXG5cblx0aWYgKG1ldHJpYy50eXBlID09PSAnaW5zdGFudCcpIHtcblx0XHRsZXQgaW5zdGFudFNlcmllcyA9IHNlcmllcyBhcyBJbnN0YW50U2VyaWVzXG5cdFx0cmV0dXJuIHBhcnNlRmxvYXQoaW5zdGFudFNlcmllcy52YWx1ZVsxXSlcblx0fSBlbHNlIHtcblx0XHRsZXQgcmFuZ2VTZXJpZXMgPSBzZXJpZXMgYXMgU2VyaWVzXG5cdFx0cmV0dXJuIGFnZ3JlZ2F0ZVZhbHVlcyhyYW5nZVNlcmllcy52YWx1ZXMsIGFnZ3JlZ2F0ZSlcblx0fVxufVxuIgogIF0sCiAgIm1hcHBpbmdzIjogIjs7O0FBZ0NPLFNBQVMsaUJBQWlCLENBQUMsU0FBNkI7QUFBQSxFQUM5RCxJQUFJLDBCQUFVLElBQUksS0FDZCxRQUFRLFFBQVEsS0FBSyxFQUFFLE1BQU07QUFBQSxDQUFJO0FBQUEsRUFFckMsU0FBUyxRQUFRLE9BQU87QUFBQSxJQUN2QixJQUFJLENBQUMsS0FBSyxLQUFLO0FBQUEsTUFBRztBQUFBLElBRWxCLElBQUk7QUFBQSxNQUNILElBQUksU0FBUyxLQUFLLE1BQU0sSUFBSTtBQUFBLE1BQzVCLFFBQVEsSUFBSSxPQUFPLE1BQU0sTUFBTTtBQUFBLE1BQzlCLE1BQU07QUFBQSxNQUVQO0FBQUE7QUFBQTtBQUFBLEVBSUYsT0FBTztBQUFBO0FBV0QsU0FBUyxhQUFhLENBQUMsUUFBMEM7QUFBQSxFQUN2RSxJQUFJLFVBQXlDLE1BQ3pDLE9BQXNDO0FBQUEsRUFFMUMsSUFBSSxPQUFPLFNBQVMsV0FBVztBQUFBLElBQzlCLElBQUksT0FBTyxPQUFPO0FBQUEsSUFDbEIsVUFBVSxLQUFLLEtBQUssQ0FBQyxNQUFNLEVBQUUsT0FBTyxRQUFRLFNBQVMsS0FBSyxNQUMxRCxPQUFPLEtBQUssS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLFFBQVEsTUFBTSxLQUFLO0FBQUEsSUFDOUM7QUFBQSxJQUNOLElBQUksT0FBTyxPQUFPO0FBQUEsSUFDbEIsVUFBVSxLQUFLLEtBQUssQ0FBQyxNQUFNLEVBQUUsT0FBTyxRQUFRLFNBQVMsS0FBSyxNQUMxRCxPQUFPLEtBQUssS0FBSyxDQUFDLE1BQU0sRUFBRSxPQUFPLFFBQVEsTUFBTSxLQUFLO0FBQUE7QUFBQSxFQUdyRCxPQUFPLEVBQUUsU0FBUyxLQUFLO0FBQUE7QUFXeEIsU0FBUyxVQUFVLENBQUMsUUFBa0IsR0FBbUI7QUFBQSxFQUN4RCxJQUFJLFNBQVMsQ0FBQyxHQUFHLE1BQU0sRUFBRSxLQUFLLENBQUMsR0FBRyxNQUFNLElBQUksQ0FBQyxHQUN6QyxRQUFRLEtBQUssS0FBSyxPQUFPLFNBQVMsQ0FBQyxJQUFJO0FBQUEsRUFDM0MsT0FBTyxPQUFPLEtBQUssSUFBSSxHQUFHLEtBQUs7QUFBQTtBQU16QixTQUFTLGVBQWUsQ0FBQyxRQUE0QixJQUErQjtBQUFBLEVBQzFGLElBQUksT0FBTyxXQUFXO0FBQUEsSUFBRyxPQUFPO0FBQUEsRUFFaEMsSUFBSSxPQUFPLE9BQU8sSUFBSSxFQUFFLEdBQUcsT0FBTyxXQUFXLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7QUFBQSxFQUV4RSxJQUFJLEtBQUssV0FBVztBQUFBLElBQUcsT0FBTztBQUFBLEVBRTlCLFFBQVE7QUFBQSxTQUNGO0FBQUEsTUFDSixPQUFPLEtBQUssS0FBSyxTQUFTO0FBQUEsU0FDdEI7QUFBQSxNQUNKLE9BQU8sS0FBSztBQUFBLFNBQ1I7QUFBQSxNQUNKLE9BQU8sS0FBSyxPQUFPLENBQUMsR0FBRyxNQUFNLElBQUksR0FBRyxDQUFDLElBQUksS0FBSztBQUFBLFNBQzFDO0FBQUEsTUFDSixPQUFPLEtBQUssSUFBSSxHQUFHLElBQUk7QUFBQSxTQUNuQjtBQUFBLE1BQ0osT0FBTyxLQUFLLElBQUksR0FBRyxJQUFJO0FBQUEsU0FDbkI7QUFBQSxNQUNKLE9BQU8sV0FBVyxNQUFNLEdBQUc7QUFBQSxTQUN2QjtBQUFBLE1BQ0osT0FBTyxXQUFXLE1BQU0sSUFBSTtBQUFBLFNBQ3hCO0FBQUEsTUFDSixPQUFPLFdBQVcsTUFBTSxJQUFJO0FBQUEsU0FDeEI7QUFBQSxNQUNKLE9BQU8sS0FBSyxPQUFPLENBQUMsR0FBRyxNQUFNLElBQUksR0FBRyxDQUFDO0FBQUEsU0FDakM7QUFBQSxNQUNKLE9BQU8sS0FBSztBQUFBO0FBQUEsTUFFWixPQUFPO0FBQUE7QUFBQTtBQU9ILFNBQVMsY0FBYyxDQUM3QixRQUNBLEtBQ0EsWUFBK0IsT0FDdEI7QUFBQSxFQUNULElBQUksWUFBWSxjQUFjLE1BQU0sR0FDaEMsU0FBUyxRQUFRLFlBQVksVUFBVSxVQUFVLFVBQVU7QUFBQSxFQUUvRCxJQUFJLENBQUM7QUFBQSxJQUFRLE9BQU87QUFBQSxFQUVwQixJQUFJLE9BQU8sU0FBUztBQUFBLElBRW5CLE9BQU8sV0FEYSxPQUNZLE1BQU0sRUFBRTtBQUFBLEVBR3hDO0FBQUEsV0FBTyxnQkFEVyxPQUNpQixRQUFRLFNBQVM7QUFBQTsiLAogICJkZWJ1Z0lkIjogIkJEQzE3Q0VCNDE3QzkxQ0U2NDc1NkUyMTY0NzU2RTIxIiwKICAibmFtZXMiOiBbXQp9
