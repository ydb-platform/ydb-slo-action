import {
  require_github
} from "../../github-jgav07sj.js";
import {
  require_core
} from "../../main-d15da32k.js";
import"../../main-2h1wxd0e.js";
import"../../main-zqznhazw.js";
import"../../main-c7r720rd.js";
import {
  __toESM
} from "../../main-ynsbc1hx.js";

// report/lib/comment.ts
var import_core = __toESM(require_core(), 1), import_github = __toESM(require_github(), 1);
function generateCommentBody(data) {
  let totalRegressions = data.workloads.reduce((sum, w) => sum + w.summary.regressions, 0), totalImprovements = data.workloads.reduce((sum, w) => sum + w.summary.improvements, 0), statusEmoji = totalRegressions > 0 ? "\uD83D\uDFE1" : "\uD83D\uDFE2", statusText = totalRegressions > 0 ? `${totalRegressions} regressions` : "All clear", header = `## \uD83C\uDF0B SLO Test Results

**Status**: ${statusEmoji} ${data.workloads.length} workloads tested • ${statusText}

${data.jobSummaryUrl ? `\uD83D\uDCC8 [View Job Summary](${data.jobSummaryUrl}) for detailed comparison
` : ""}`, table = `
| Workload | Metrics | Regressions | Improvements | Links |
|----------|---------|-------------|--------------|-------|
${data.workloads.map((w) => {
    let emoji = w.summary.regressions > 0 ? "\uD83D\uDFE1" : w.summary.improvements > 0 ? "\uD83D\uDFE2" : "⚪", reportLink = data.artifactUrls.get(w.workload) || "#", checkLink = data.checkUrls.get(w.workload) || "#";
    return `| ${emoji} ${w.workload} | ${w.summary.total} | ${w.summary.regressions} | ${w.summary.improvements} | [Report](${reportLink}) • [Check](${checkLink}) |`;
  }).join(`
`)}
`, footer = `
---
*Generated by [ydb-slo-action](https://github.com/ydb-platform/ydb-slo-action)*`;
  return header + table + footer;
}
async function findExistingSLOComment(token, owner, repo, prNumber) {
  let octokit = import_github.getOctokit(token);
  import_core.info(`Searching for existing SLO comment in PR #${prNumber}...`);
  let { data: comments } = await octokit.rest.issues.listComments({
    owner,
    repo,
    issue_number: prNumber
  });
  for (let comment of comments)
    if (comment.body?.includes("\uD83C\uDF0B SLO Test Results"))
      return import_core.info(`Found existing comment: ${comment.id}`), comment.id;
  return null;
}
async function createOrUpdateComment(token, owner, repo, prNumber, body) {
  let octokit = import_github.getOctokit(token), existingId = await findExistingSLOComment(token, owner, repo, prNumber);
  if (existingId) {
    import_core.info(`Updating existing comment ${existingId}...`);
    let { data } = await octokit.rest.issues.updateComment({
      owner,
      repo,
      comment_id: existingId,
      body
    });
    return import_core.info(`Comment updated: ${data.html_url}`), { url: data.html_url, id: data.id };
  } else {
    import_core.info("Creating new comment...");
    let { data } = await octokit.rest.issues.createComment({
      owner,
      repo,
      issue_number: prNumber,
      body
    });
    return import_core.info(`Comment created: ${data.html_url}`), { url: data.html_url, id: data.id };
  }
}
export {
  generateCommentBody,
  findExistingSLOComment,
  createOrUpdateComment
};

export { generateCommentBody, createOrUpdateComment };

//# debugId=8AC1A86DE3D6C92164756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vcmVwb3J0L2xpYi9jb21tZW50LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWwogICAgIi8qKlxuICogR2l0SHViIFBSIGNvbW1lbnQgZ2VuZXJhdGlvbiBhbmQgbWFuYWdlbWVudFxuICovXG5cbmltcG9ydCB7IGluZm8gfSBmcm9tICdAYWN0aW9ucy9jb3JlJ1xuaW1wb3J0IHsgZ2V0T2N0b2tpdCB9IGZyb20gJ0BhY3Rpb25zL2dpdGh1YidcblxuaW1wb3J0IHR5cGUgeyBXb3JrbG9hZENvbXBhcmlzb24gfSBmcm9tICcuL2FuYWx5c2lzLmpzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1lbnREYXRhIHtcblx0d29ya2xvYWRzOiBXb3JrbG9hZENvbXBhcmlzb25bXVxuXHRhcnRpZmFjdFVybHM6IE1hcDxzdHJpbmcsIHN0cmluZz5cblx0Y2hlY2tVcmxzOiBNYXA8c3RyaW5nLCBzdHJpbmc+XG5cdGpvYlN1bW1hcnlVcmw/OiBzdHJpbmdcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBQUiBjb21tZW50IGJvZHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlQ29tbWVudEJvZHkoZGF0YTogQ29tbWVudERhdGEpOiBzdHJpbmcge1xuXHRsZXQgdG90YWxSZWdyZXNzaW9ucyA9IGRhdGEud29ya2xvYWRzLnJlZHVjZSgoc3VtLCB3KSA9PiBzdW0gKyB3LnN1bW1hcnkucmVncmVzc2lvbnMsIDApXG5cdGxldCB0b3RhbEltcHJvdmVtZW50cyA9IGRhdGEud29ya2xvYWRzLnJlZHVjZSgoc3VtLCB3KSA9PiBzdW0gKyB3LnN1bW1hcnkuaW1wcm92ZW1lbnRzLCAwKVxuXG5cdGxldCBzdGF0dXNFbW9qaSA9IHRvdGFsUmVncmVzc2lvbnMgPiAwID8gJ/Cfn6EnIDogJ/Cfn6InXG5cdGxldCBzdGF0dXNUZXh0ID0gdG90YWxSZWdyZXNzaW9ucyA+IDAgPyBgJHt0b3RhbFJlZ3Jlc3Npb25zfSByZWdyZXNzaW9uc2AgOiAnQWxsIGNsZWFyJ1xuXG5cdGxldCBoZWFkZXIgPSBgIyMg8J+MiyBTTE8gVGVzdCBSZXN1bHRzXG5cbioqU3RhdHVzKio6ICR7c3RhdHVzRW1vaml9ICR7ZGF0YS53b3JrbG9hZHMubGVuZ3RofSB3b3JrbG9hZHMgdGVzdGVkIOKAoiAke3N0YXR1c1RleHR9XG5cbiR7ZGF0YS5qb2JTdW1tYXJ5VXJsID8gYPCfk4ggW1ZpZXcgSm9iIFN1bW1hcnldKCR7ZGF0YS5qb2JTdW1tYXJ5VXJsfSkgZm9yIGRldGFpbGVkIGNvbXBhcmlzb25cXG5gIDogJyd9YFxuXG5cdGxldCB0YWJsZSA9IGBcbnwgV29ya2xvYWQgfCBNZXRyaWNzIHwgUmVncmVzc2lvbnMgfCBJbXByb3ZlbWVudHMgfCBMaW5rcyB8XG58LS0tLS0tLS0tLXwtLS0tLS0tLS18LS0tLS0tLS0tLS0tLXwtLS0tLS0tLS0tLS0tLXwtLS0tLS0tfFxuJHtkYXRhLndvcmtsb2Fkc1xuXHQubWFwKCh3KSA9PiB7XG5cdFx0bGV0IGVtb2ppID0gdy5zdW1tYXJ5LnJlZ3Jlc3Npb25zID4gMCA/ICfwn5+hJyA6IHcuc3VtbWFyeS5pbXByb3ZlbWVudHMgPiAwID8gJ/Cfn6InIDogJ+Kaqidcblx0XHRsZXQgcmVwb3J0TGluayA9IGRhdGEuYXJ0aWZhY3RVcmxzLmdldCh3Lndvcmtsb2FkKSB8fCAnIydcblx0XHRsZXQgY2hlY2tMaW5rID0gZGF0YS5jaGVja1VybHMuZ2V0KHcud29ya2xvYWQpIHx8ICcjJ1xuXG5cdFx0cmV0dXJuIGB8ICR7ZW1vaml9ICR7dy53b3JrbG9hZH0gfCAke3cuc3VtbWFyeS50b3RhbH0gfCAke3cuc3VtbWFyeS5yZWdyZXNzaW9uc30gfCAke3cuc3VtbWFyeS5pbXByb3ZlbWVudHN9IHwgW1JlcG9ydF0oJHtyZXBvcnRMaW5rfSkg4oCiIFtDaGVja10oJHtjaGVja0xpbmt9KSB8YFxuXHR9KVxuXHQuam9pbignXFxuJyl9XG5gXG5cblx0bGV0IGZvb3RlciA9IGBcXG4tLS1cXG4qR2VuZXJhdGVkIGJ5IFt5ZGItc2xvLWFjdGlvbl0oaHR0cHM6Ly9naXRodWIuY29tL3lkYi1wbGF0Zm9ybS95ZGItc2xvLWFjdGlvbikqYFxuXG5cdHJldHVybiBoZWFkZXIgKyB0YWJsZSArIGZvb3RlclxufVxuXG4vKipcbiAqIEZpbmQgZXhpc3RpbmcgU0xPIGNvbW1lbnQgaW4gUFJcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZpbmRFeGlzdGluZ1NMT0NvbW1lbnQodG9rZW46IHN0cmluZywgb3duZXI6IHN0cmluZywgcmVwbzogc3RyaW5nLCBwck51bWJlcjogbnVtYmVyKTogUHJvbWlzZTxudW1iZXIgfCBudWxsPiB7XG5cdGxldCBvY3Rva2l0ID0gZ2V0T2N0b2tpdCh0b2tlbilcblxuXHRpbmZvKGBTZWFyY2hpbmcgZm9yIGV4aXN0aW5nIFNMTyBjb21tZW50IGluIFBSICMke3ByTnVtYmVyfS4uLmApXG5cblx0bGV0IHsgZGF0YTogY29tbWVudHMgfSA9IGF3YWl0IG9jdG9raXQucmVzdC5pc3N1ZXMubGlzdENvbW1lbnRzKHtcblx0XHRvd25lcixcblx0XHRyZXBvLFxuXHRcdGlzc3VlX251bWJlcjogcHJOdW1iZXIsXG5cdH0pXG5cblx0Zm9yIChsZXQgY29tbWVudCBvZiBjb21tZW50cykge1xuXHRcdGlmIChjb21tZW50LmJvZHk/LmluY2x1ZGVzKCfwn4yLIFNMTyBUZXN0IFJlc3VsdHMnKSkge1xuXHRcdFx0aW5mbyhgRm91bmQgZXhpc3RpbmcgY29tbWVudDogJHtjb21tZW50LmlkfWApXG5cdFx0XHRyZXR1cm4gY29tbWVudC5pZFxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBudWxsXG59XG5cbi8qKlxuICogQ3JlYXRlIG9yIHVwZGF0ZSBQUiBjb21tZW50XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVPclVwZGF0ZUNvbW1lbnQoXG5cdHRva2VuOiBzdHJpbmcsXG5cdG93bmVyOiBzdHJpbmcsXG5cdHJlcG86IHN0cmluZyxcblx0cHJOdW1iZXI6IG51bWJlcixcblx0Ym9keTogc3RyaW5nXG4pOiBQcm9taXNlPHsgdXJsOiBzdHJpbmc7IGlkOiBudW1iZXIgfT4ge1xuXHRsZXQgb2N0b2tpdCA9IGdldE9jdG9raXQodG9rZW4pXG5cblx0bGV0IGV4aXN0aW5nSWQgPSBhd2FpdCBmaW5kRXhpc3RpbmdTTE9Db21tZW50KHRva2VuLCBvd25lciwgcmVwbywgcHJOdW1iZXIpXG5cblx0aWYgKGV4aXN0aW5nSWQpIHtcblx0XHRpbmZvKGBVcGRhdGluZyBleGlzdGluZyBjb21tZW50ICR7ZXhpc3RpbmdJZH0uLi5gKVxuXG5cdFx0bGV0IHsgZGF0YSB9ID0gYXdhaXQgb2N0b2tpdC5yZXN0Lmlzc3Vlcy51cGRhdGVDb21tZW50KHtcblx0XHRcdG93bmVyLFxuXHRcdFx0cmVwbyxcblx0XHRcdGNvbW1lbnRfaWQ6IGV4aXN0aW5nSWQsXG5cdFx0XHRib2R5LFxuXHRcdH0pXG5cblx0XHRpbmZvKGBDb21tZW50IHVwZGF0ZWQ6ICR7ZGF0YS5odG1sX3VybH1gKVxuXG5cdFx0cmV0dXJuIHsgdXJsOiBkYXRhLmh0bWxfdXJsISwgaWQ6IGRhdGEuaWQgfVxuXHR9IGVsc2Uge1xuXHRcdGluZm8oYENyZWF0aW5nIG5ldyBjb21tZW50Li4uYClcblxuXHRcdGxldCB7IGRhdGEgfSA9IGF3YWl0IG9jdG9raXQucmVzdC5pc3N1ZXMuY3JlYXRlQ29tbWVudCh7XG5cdFx0XHRvd25lcixcblx0XHRcdHJlcG8sXG5cdFx0XHRpc3N1ZV9udW1iZXI6IHByTnVtYmVyLFxuXHRcdFx0Ym9keSxcblx0XHR9KVxuXG5cdFx0aW5mbyhgQ29tbWVudCBjcmVhdGVkOiAke2RhdGEuaHRtbF91cmx9YClcblxuXHRcdHJldHVybiB7IHVybDogZGF0YS5odG1sX3VybCEsIGlkOiBkYXRhLmlkIH1cblx0fVxufVxuIgogIF0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7QUFJQSw4Q0FDQTtBQWNPLFNBQVMsbUJBQW1CLENBQUMsTUFBMkI7QUFBQSxFQUM5RCxJQUFJLG1CQUFtQixLQUFLLFVBQVUsT0FBTyxDQUFDLEtBQUssTUFBTSxNQUFNLEVBQUUsUUFBUSxhQUFhLENBQUMsR0FDbkYsb0JBQW9CLEtBQUssVUFBVSxPQUFPLENBQUMsS0FBSyxNQUFNLE1BQU0sRUFBRSxRQUFRLGNBQWMsQ0FBQyxHQUVyRixjQUFjLG1CQUFtQixJQUFJLGlCQUFNLGdCQUMzQyxhQUFhLG1CQUFtQixJQUFJLEdBQUcsaUNBQWlDLGFBRXhFLFNBQVM7QUFBQTtBQUFBLGNBRUEsZUFBZSxLQUFLLFVBQVUsNkJBQTRCO0FBQUE7QUFBQSxFQUV0RSxLQUFLLGdCQUFnQixtQ0FBd0IsS0FBSztBQUFBLElBQTZDLE1BRTVGLFFBQVE7QUFBQTtBQUFBO0FBQUEsRUFHWCxLQUFLLFVBQ0wsSUFBSSxDQUFDLE1BQU07QUFBQSxJQUNYLElBQUksUUFBUSxFQUFFLFFBQVEsY0FBYyxJQUFJLGlCQUFNLEVBQUUsUUFBUSxlQUFlLElBQUksaUJBQU8sS0FDOUUsYUFBYSxLQUFLLGFBQWEsSUFBSSxFQUFFLFFBQVEsS0FBSyxLQUNsRCxZQUFZLEtBQUssVUFBVSxJQUFJLEVBQUUsUUFBUSxLQUFLO0FBQUEsSUFFbEQsT0FBTyxLQUFLLFNBQVMsRUFBRSxjQUFjLEVBQUUsUUFBUSxXQUFXLEVBQUUsUUFBUSxpQkFBaUIsRUFBRSxRQUFRLDJCQUEyQix5QkFBd0I7QUFBQSxHQUNsSixFQUNBLEtBQUs7QUFBQSxDQUFJO0FBQUEsR0FHTixTQUFTO0FBQUE7QUFBQTtBQUFBLEVBRWIsT0FBTyxTQUFTLFFBQVE7QUFBQTtBQU16QixlQUFzQixzQkFBc0IsQ0FBQyxPQUFlLE9BQWUsTUFBYyxVQUEwQztBQUFBLEVBQ2xJLElBQUksVUFBVSx5QkFBVyxLQUFLO0FBQUEsRUFFOUIsaUJBQUssNkNBQTZDLGFBQWE7QUFBQSxFQUUvRCxNQUFNLE1BQU0sYUFBYSxNQUFNLFFBQVEsS0FBSyxPQUFPLGFBQWE7QUFBQSxJQUMvRDtBQUFBLElBQ0E7QUFBQSxJQUNBLGNBQWM7QUFBQSxFQUNmLENBQUM7QUFBQSxFQUVELFNBQVMsV0FBVztBQUFBLElBQ25CLElBQUksUUFBUSxNQUFNLFNBQVMsK0JBQW9CO0FBQUEsTUFFOUMsT0FEQSxpQkFBSywyQkFBMkIsUUFBUSxJQUFJLEdBQ3JDLFFBQVE7QUFBQSxFQUlqQixPQUFPO0FBQUE7QUFNUixlQUFzQixxQkFBcUIsQ0FDMUMsT0FDQSxPQUNBLE1BQ0EsVUFDQSxNQUN1QztBQUFBLEVBQ3ZDLElBQUksVUFBVSx5QkFBVyxLQUFLLEdBRTFCLGFBQWEsTUFBTSx1QkFBdUIsT0FBTyxPQUFPLE1BQU0sUUFBUTtBQUFBLEVBRTFFLElBQUksWUFBWTtBQUFBLElBQ2YsaUJBQUssNkJBQTZCLGVBQWU7QUFBQSxJQUVqRCxNQUFNLFNBQVMsTUFBTSxRQUFRLEtBQUssT0FBTyxjQUFjO0FBQUEsTUFDdEQ7QUFBQSxNQUNBO0FBQUEsTUFDQSxZQUFZO0FBQUEsTUFDWjtBQUFBLElBQ0QsQ0FBQztBQUFBLElBSUQsT0FGQSxpQkFBSyxvQkFBb0IsS0FBSyxVQUFVLEdBRWpDLEVBQUUsS0FBSyxLQUFLLFVBQVcsSUFBSSxLQUFLLEdBQUc7QUFBQSxJQUNwQztBQUFBLElBQ04saUJBQUsseUJBQXlCO0FBQUEsSUFFOUIsTUFBTSxTQUFTLE1BQU0sUUFBUSxLQUFLLE9BQU8sY0FBYztBQUFBLE1BQ3REO0FBQUEsTUFDQTtBQUFBLE1BQ0EsY0FBYztBQUFBLE1BQ2Q7QUFBQSxJQUNELENBQUM7QUFBQSxJQUlELE9BRkEsaUJBQUssb0JBQW9CLEtBQUssVUFBVSxHQUVqQyxFQUFFLEtBQUssS0FBSyxVQUFXLElBQUksS0FBSyxHQUFHO0FBQUE7QUFBQTsiLAogICJkZWJ1Z0lkIjogIjhBQzFBODZERTNENkM5MjE2NDc1NkUyMTY0NzU2RTIxIiwKICAibmFtZXMiOiBbXQp9
