import {
  formatChange,
  formatValue
} from "./analysis.js";
import {
  evaluateWorkloadThresholds
} from "./thresholds.js";
import {
  require_core
} from "../../main-gq2p93nb.js";
import {
  require_github
} from "../../github-jgav07sj.js";
import"../../main-2h1wxd0e.js";
import"../../main-zqznhazw.js";
import {
  __toESM
} from "../../main-ynsbc1hx.js";

// report/lib/checks.ts
var import_core = __toESM(require_core(), 1), import_github = __toESM(require_github(), 1);
async function createWorkloadCheck(options) {
  let octokit = import_github.getOctokit(options.token), name = `SLO: ${options.workload.workload}`, evaluation = evaluateWorkloadThresholds(options.workload.metrics, options.thresholds), conclusion = determineConclusionFromEvaluation(evaluation.overall), title = generateTitle(options.workload, evaluation), summaryText = generateSummary(options.workload, evaluation, options.reportUrl);
  import_core.info(`Creating check "${name}" with conclusion: ${conclusion}`);
  let { data } = await octokit.rest.checks.create({
    owner: options.owner,
    repo: options.repo,
    name,
    head_sha: options.sha,
    status: "completed",
    conclusion,
    output: {
      title,
      summary: summaryText
    }
  });
  return import_core.info(`Check created: ${data.html_url}`), { id: data.id, url: data.html_url };
}
function determineConclusionFromEvaluation(severity) {
  if (severity === "failure")
    return "failure";
  if (severity === "warning")
    return "neutral";
  return "success";
}
function generateTitle(workload, evaluation) {
  if (evaluation.failures.length > 0)
    return `${evaluation.failures.length} critical threshold(s) violated`;
  if (evaluation.warnings.length > 0)
    return `${evaluation.warnings.length} warning threshold(s) exceeded`;
  if (workload.summary.improvements > 0)
    return `${workload.summary.improvements} improvement(s) detected`;
  return "All metrics within thresholds";
}
function generateSummary(workload, evaluation, reportUrl) {
  let lines = [
    `**Metrics analyzed:** ${workload.summary.total}`,
    `- \uD83D\uDD34 Critical: ${evaluation.failures.length}`,
    `- \uD83D\uDFE1 Warnings: ${evaluation.warnings.length}`,
    `- \uD83D\uDFE2 Improvements: ${workload.summary.improvements}`,
    `- ⚪ Stable: ${workload.summary.stable}`,
    ""
  ];
  if (reportUrl)
    lines.push(`\uD83D\uDCCA [View detailed HTML report](${reportUrl})`, "");
  if (evaluation.failures.length > 0) {
    lines.push("### ❌ Critical Thresholds Violated", "");
    for (let metric of evaluation.failures.slice(0, 5))
      lines.push(`- **${metric.name}**: ${formatValue(metric.current.value, metric.name)} (${formatChange(metric.change.percent, metric.change.direction)})`);
    lines.push("");
  }
  if (evaluation.warnings.length > 0) {
    lines.push("### ⚠️ Warning Thresholds Exceeded", "");
    for (let metric of evaluation.warnings.slice(0, 5))
      lines.push(`- **${metric.name}**: ${formatValue(metric.current.value, metric.name)} (${formatChange(metric.change.percent, metric.change.direction)})`);
    lines.push("");
  }
  let improvements = workload.metrics.filter((m) => m.change.direction === "better").sort((a, b) => Math.abs(b.change.percent) - Math.abs(a.change.percent));
  if (improvements.length > 0) {
    lines.push("### \uD83D\uDFE2 Top Improvements", "");
    for (let metric of improvements.slice(0, 5))
      lines.push(`- **${metric.name}**: ${formatValue(metric.current.value, metric.name)} (${formatChange(metric.change.percent, metric.change.direction)})`);
  }
  return lines.join(`
`);
}
export {
  createWorkloadCheck
};

export { createWorkloadCheck };

//# debugId=2FC35DF934685DAD64756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vcmVwb3J0L2xpYi9jaGVja3MudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbCiAgICAiLyoqXG4gKiBHaXRIdWIgQ2hlY2tzIEFQSSBpbnRlZ3JhdGlvblxuICovXG5cbmltcG9ydCB7IGluZm8gfSBmcm9tICdAYWN0aW9ucy9jb3JlJ1xuaW1wb3J0IHsgZ2V0T2N0b2tpdCB9IGZyb20gJ0BhY3Rpb25zL2dpdGh1YidcblxuaW1wb3J0IHsgZm9ybWF0Q2hhbmdlLCBmb3JtYXRWYWx1ZSwgdHlwZSBXb3JrbG9hZENvbXBhcmlzb24gfSBmcm9tICcuL2FuYWx5c2lzLmpzJ1xuaW1wb3J0IHsgZXZhbHVhdGVXb3JrbG9hZFRocmVzaG9sZHMsIHR5cGUgVGhyZXNob2xkQ29uZmlnIH0gZnJvbSAnLi90aHJlc2hvbGRzLmpzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIENoZWNrT3B0aW9ucyB7XG5cdHRva2VuOiBzdHJpbmdcblx0b3duZXI6IHN0cmluZ1xuXHRyZXBvOiBzdHJpbmdcblx0c2hhOiBzdHJpbmdcblx0d29ya2xvYWQ6IFdvcmtsb2FkQ29tcGFyaXNvblxuXHR0aHJlc2hvbGRzOiBUaHJlc2hvbGRDb25maWdcblx0cmVwb3J0VXJsPzogc3RyaW5nXG59XG5cbi8qKlxuICogQ3JlYXRlIEdpdEh1YiBDaGVjayBmb3Igd29ya2xvYWRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVdvcmtsb2FkQ2hlY2sob3B0aW9uczogQ2hlY2tPcHRpb25zKTogUHJvbWlzZTx7IGlkOiBudW1iZXI7IHVybDogc3RyaW5nIH0+IHtcblx0bGV0IG9jdG9raXQgPSBnZXRPY3Rva2l0KG9wdGlvbnMudG9rZW4pXG5cblx0bGV0IG5hbWUgPSBgU0xPOiAke29wdGlvbnMud29ya2xvYWQud29ya2xvYWR9YFxuXHRsZXQgZXZhbHVhdGlvbiA9IGV2YWx1YXRlV29ya2xvYWRUaHJlc2hvbGRzKG9wdGlvbnMud29ya2xvYWQubWV0cmljcywgb3B0aW9ucy50aHJlc2hvbGRzKVxuXHRsZXQgY29uY2x1c2lvbiA9IGRldGVybWluZUNvbmNsdXNpb25Gcm9tRXZhbHVhdGlvbihldmFsdWF0aW9uLm92ZXJhbGwpXG5cdGxldCB0aXRsZSA9IGdlbmVyYXRlVGl0bGUob3B0aW9ucy53b3JrbG9hZCwgZXZhbHVhdGlvbilcblx0bGV0IHN1bW1hcnlUZXh0ID0gZ2VuZXJhdGVTdW1tYXJ5KG9wdGlvbnMud29ya2xvYWQsIGV2YWx1YXRpb24sIG9wdGlvbnMucmVwb3J0VXJsKVxuXG5cdGluZm8oYENyZWF0aW5nIGNoZWNrIFwiJHtuYW1lfVwiIHdpdGggY29uY2x1c2lvbjogJHtjb25jbHVzaW9ufWApXG5cblx0bGV0IHsgZGF0YSB9ID0gYXdhaXQgb2N0b2tpdC5yZXN0LmNoZWNrcy5jcmVhdGUoe1xuXHRcdG93bmVyOiBvcHRpb25zLm93bmVyLFxuXHRcdHJlcG86IG9wdGlvbnMucmVwbyxcblx0XHRuYW1lLFxuXHRcdGhlYWRfc2hhOiBvcHRpb25zLnNoYSxcblx0XHRzdGF0dXM6ICdjb21wbGV0ZWQnLFxuXHRcdGNvbmNsdXNpb24sXG5cdFx0b3V0cHV0OiB7XG5cdFx0XHR0aXRsZSxcblx0XHRcdHN1bW1hcnk6IHN1bW1hcnlUZXh0LFxuXHRcdH0sXG5cdH0pXG5cblx0aW5mbyhgQ2hlY2sgY3JlYXRlZDogJHtkYXRhLmh0bWxfdXJsfWApXG5cblx0cmV0dXJuIHsgaWQ6IGRhdGEuaWQsIHVybDogZGF0YS5odG1sX3VybCEgfVxufVxuXG4vKipcbiAqIE1hcCB0aHJlc2hvbGQgc2V2ZXJpdHkgdG8gR2l0SHViIENoZWNrIGNvbmNsdXNpb25cbiAqL1xuZnVuY3Rpb24gZGV0ZXJtaW5lQ29uY2x1c2lvbkZyb21FdmFsdWF0aW9uKFxuXHRzZXZlcml0eTogJ3N1Y2Nlc3MnIHwgJ3dhcm5pbmcnIHwgJ2ZhaWx1cmUnXG4pOiAnc3VjY2VzcycgfCAnbmV1dHJhbCcgfCAnZmFpbHVyZScge1xuXHRpZiAoc2V2ZXJpdHkgPT09ICdmYWlsdXJlJykgcmV0dXJuICdmYWlsdXJlJ1xuXHRpZiAoc2V2ZXJpdHkgPT09ICd3YXJuaW5nJykgcmV0dXJuICduZXV0cmFsJ1xuXHRyZXR1cm4gJ3N1Y2Nlc3MnXG59XG5cbi8qKlxuICogR2VuZXJhdGUgY2hlY2sgdGl0bGVcbiAqL1xuZnVuY3Rpb24gZ2VuZXJhdGVUaXRsZShcblx0d29ya2xvYWQ6IFdvcmtsb2FkQ29tcGFyaXNvbixcblx0ZXZhbHVhdGlvbjogeyBvdmVyYWxsOiBzdHJpbmc7IGZhaWx1cmVzOiBhbnlbXTsgd2FybmluZ3M6IGFueVtdIH1cbik6IHN0cmluZyB7XG5cdGlmIChldmFsdWF0aW9uLmZhaWx1cmVzLmxlbmd0aCA+IDApIHtcblx0XHRyZXR1cm4gYCR7ZXZhbHVhdGlvbi5mYWlsdXJlcy5sZW5ndGh9IGNyaXRpY2FsIHRocmVzaG9sZChzKSB2aW9sYXRlZGBcblx0fVxuXG5cdGlmIChldmFsdWF0aW9uLndhcm5pbmdzLmxlbmd0aCA+IDApIHtcblx0XHRyZXR1cm4gYCR7ZXZhbHVhdGlvbi53YXJuaW5ncy5sZW5ndGh9IHdhcm5pbmcgdGhyZXNob2xkKHMpIGV4Y2VlZGVkYFxuXHR9XG5cblx0aWYgKHdvcmtsb2FkLnN1bW1hcnkuaW1wcm92ZW1lbnRzID4gMCkge1xuXHRcdHJldHVybiBgJHt3b3JrbG9hZC5zdW1tYXJ5LmltcHJvdmVtZW50c30gaW1wcm92ZW1lbnQocykgZGV0ZWN0ZWRgXG5cdH1cblxuXHRyZXR1cm4gJ0FsbCBtZXRyaWNzIHdpdGhpbiB0aHJlc2hvbGRzJ1xufVxuXG4vKipcbiAqIEdlbmVyYXRlIGNoZWNrIHN1bW1hcnlcbiAqL1xuZnVuY3Rpb24gZ2VuZXJhdGVTdW1tYXJ5KFxuXHR3b3JrbG9hZDogV29ya2xvYWRDb21wYXJpc29uLFxuXHRldmFsdWF0aW9uOiB7IG92ZXJhbGw6IHN0cmluZzsgZmFpbHVyZXM6IGFueVtdOyB3YXJuaW5nczogYW55W10gfSxcblx0cmVwb3J0VXJsPzogc3RyaW5nXG4pOiBzdHJpbmcge1xuXHRsZXQgbGluZXMgPSBbXG5cdFx0YCoqTWV0cmljcyBhbmFseXplZDoqKiAke3dvcmtsb2FkLnN1bW1hcnkudG90YWx9YCxcblx0XHRgLSDwn5S0IENyaXRpY2FsOiAke2V2YWx1YXRpb24uZmFpbHVyZXMubGVuZ3RofWAsXG5cdFx0YC0g8J+foSBXYXJuaW5nczogJHtldmFsdWF0aW9uLndhcm5pbmdzLmxlbmd0aH1gLFxuXHRcdGAtIPCfn6IgSW1wcm92ZW1lbnRzOiAke3dvcmtsb2FkLnN1bW1hcnkuaW1wcm92ZW1lbnRzfWAsXG5cdFx0YC0g4pqqIFN0YWJsZTogJHt3b3JrbG9hZC5zdW1tYXJ5LnN0YWJsZX1gLFxuXHRcdCcnLFxuXHRdXG5cblx0aWYgKHJlcG9ydFVybCkge1xuXHRcdGxpbmVzLnB1c2goYPCfk4ogW1ZpZXcgZGV0YWlsZWQgSFRNTCByZXBvcnRdKCR7cmVwb3J0VXJsfSlgLCAnJylcblx0fVxuXG5cdC8vIENyaXRpY2FsIGZhaWx1cmVzXG5cdGlmIChldmFsdWF0aW9uLmZhaWx1cmVzLmxlbmd0aCA+IDApIHtcblx0XHRsaW5lcy5wdXNoKCcjIyMg4p2MIENyaXRpY2FsIFRocmVzaG9sZHMgVmlvbGF0ZWQnLCAnJylcblxuXHRcdGZvciAobGV0IG1ldHJpYyBvZiBldmFsdWF0aW9uLmZhaWx1cmVzLnNsaWNlKDAsIDUpKSB7XG5cdFx0XHRsaW5lcy5wdXNoKFxuXHRcdFx0XHRgLSAqKiR7bWV0cmljLm5hbWV9Kio6ICR7Zm9ybWF0VmFsdWUobWV0cmljLmN1cnJlbnQudmFsdWUsIG1ldHJpYy5uYW1lKX0gKCR7Zm9ybWF0Q2hhbmdlKG1ldHJpYy5jaGFuZ2UucGVyY2VudCwgbWV0cmljLmNoYW5nZS5kaXJlY3Rpb24pfSlgXG5cdFx0XHQpXG5cdFx0fVxuXG5cdFx0bGluZXMucHVzaCgnJylcblx0fVxuXG5cdC8vIFdhcm5pbmdzXG5cdGlmIChldmFsdWF0aW9uLndhcm5pbmdzLmxlbmd0aCA+IDApIHtcblx0XHRsaW5lcy5wdXNoKCcjIyMg4pqg77iPIFdhcm5pbmcgVGhyZXNob2xkcyBFeGNlZWRlZCcsICcnKVxuXG5cdFx0Zm9yIChsZXQgbWV0cmljIG9mIGV2YWx1YXRpb24ud2FybmluZ3Muc2xpY2UoMCwgNSkpIHtcblx0XHRcdGxpbmVzLnB1c2goXG5cdFx0XHRcdGAtICoqJHttZXRyaWMubmFtZX0qKjogJHtmb3JtYXRWYWx1ZShtZXRyaWMuY3VycmVudC52YWx1ZSwgbWV0cmljLm5hbWUpfSAoJHtmb3JtYXRDaGFuZ2UobWV0cmljLmNoYW5nZS5wZXJjZW50LCBtZXRyaWMuY2hhbmdlLmRpcmVjdGlvbil9KWBcblx0XHRcdClcblx0XHR9XG5cblx0XHRsaW5lcy5wdXNoKCcnKVxuXHR9XG5cblx0Ly8gVG9wIGltcHJvdmVtZW50c1xuXHRsZXQgaW1wcm92ZW1lbnRzID0gd29ya2xvYWQubWV0cmljc1xuXHRcdC5maWx0ZXIoKG0pID0+IG0uY2hhbmdlLmRpcmVjdGlvbiA9PT0gJ2JldHRlcicpXG5cdFx0LnNvcnQoKGEsIGIpID0+IE1hdGguYWJzKGIuY2hhbmdlLnBlcmNlbnQpIC0gTWF0aC5hYnMoYS5jaGFuZ2UucGVyY2VudCkpXG5cblx0aWYgKGltcHJvdmVtZW50cy5sZW5ndGggPiAwKSB7XG5cdFx0bGluZXMucHVzaCgnIyMjIPCfn6IgVG9wIEltcHJvdmVtZW50cycsICcnKVxuXG5cdFx0Zm9yIChsZXQgbWV0cmljIG9mIGltcHJvdmVtZW50cy5zbGljZSgwLCA1KSkge1xuXHRcdFx0bGluZXMucHVzaChcblx0XHRcdFx0YC0gKioke21ldHJpYy5uYW1lfSoqOiAke2Zvcm1hdFZhbHVlKG1ldHJpYy5jdXJyZW50LnZhbHVlLCBtZXRyaWMubmFtZSl9ICgke2Zvcm1hdENoYW5nZShtZXRyaWMuY2hhbmdlLnBlcmNlbnQsIG1ldHJpYy5jaGFuZ2UuZGlyZWN0aW9uKX0pYFxuXHRcdFx0KVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiBsaW5lcy5qb2luKCdcXG4nKVxufVxuIgogIF0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJQSw4Q0FDQTtBQWtCQSxlQUFzQixtQkFBbUIsQ0FBQyxTQUE2RDtBQUFBLEVBQ3RHLElBQUksVUFBVSx5QkFBVyxRQUFRLEtBQUssR0FFbEMsT0FBTyxRQUFRLFFBQVEsU0FBUyxZQUNoQyxhQUFhLDJCQUEyQixRQUFRLFNBQVMsU0FBUyxRQUFRLFVBQVUsR0FDcEYsYUFBYSxrQ0FBa0MsV0FBVyxPQUFPLEdBQ2pFLFFBQVEsY0FBYyxRQUFRLFVBQVUsVUFBVSxHQUNsRCxjQUFjLGdCQUFnQixRQUFRLFVBQVUsWUFBWSxRQUFRLFNBQVM7QUFBQSxFQUVqRixpQkFBSyxtQkFBbUIsMEJBQTBCLFlBQVk7QUFBQSxFQUU5RCxNQUFNLFNBQVMsTUFBTSxRQUFRLEtBQUssT0FBTyxPQUFPO0FBQUEsSUFDL0MsT0FBTyxRQUFRO0FBQUEsSUFDZixNQUFNLFFBQVE7QUFBQSxJQUNkO0FBQUEsSUFDQSxVQUFVLFFBQVE7QUFBQSxJQUNsQixRQUFRO0FBQUEsSUFDUjtBQUFBLElBQ0EsUUFBUTtBQUFBLE1BQ1A7QUFBQSxNQUNBLFNBQVM7QUFBQSxJQUNWO0FBQUEsRUFDRCxDQUFDO0FBQUEsRUFJRCxPQUZBLGlCQUFLLGtCQUFrQixLQUFLLFVBQVUsR0FFL0IsRUFBRSxJQUFJLEtBQUssSUFBSSxLQUFLLEtBQUssU0FBVTtBQUFBO0FBTTNDLFNBQVMsaUNBQWlDLENBQ3pDLFVBQ29DO0FBQUEsRUFDcEMsSUFBSSxhQUFhO0FBQUEsSUFBVyxPQUFPO0FBQUEsRUFDbkMsSUFBSSxhQUFhO0FBQUEsSUFBVyxPQUFPO0FBQUEsRUFDbkMsT0FBTztBQUFBO0FBTVIsU0FBUyxhQUFhLENBQ3JCLFVBQ0EsWUFDUztBQUFBLEVBQ1QsSUFBSSxXQUFXLFNBQVMsU0FBUztBQUFBLElBQ2hDLE9BQU8sR0FBRyxXQUFXLFNBQVM7QUFBQSxFQUcvQixJQUFJLFdBQVcsU0FBUyxTQUFTO0FBQUEsSUFDaEMsT0FBTyxHQUFHLFdBQVcsU0FBUztBQUFBLEVBRy9CLElBQUksU0FBUyxRQUFRLGVBQWU7QUFBQSxJQUNuQyxPQUFPLEdBQUcsU0FBUyxRQUFRO0FBQUEsRUFHNUIsT0FBTztBQUFBO0FBTVIsU0FBUyxlQUFlLENBQ3ZCLFVBQ0EsWUFDQSxXQUNTO0FBQUEsRUFDVCxJQUFJLFFBQVE7QUFBQSxJQUNYLHlCQUF5QixTQUFTLFFBQVE7QUFBQSxJQUMxQyw0QkFBaUIsV0FBVyxTQUFTO0FBQUEsSUFDckMsNEJBQWlCLFdBQVcsU0FBUztBQUFBLElBQ3JDLGdDQUFxQixTQUFTLFFBQVE7QUFBQSxJQUN0QyxlQUFjLFNBQVMsUUFBUTtBQUFBLElBQy9CO0FBQUEsRUFDRDtBQUFBLEVBRUEsSUFBSTtBQUFBLElBQ0gsTUFBTSxLQUFLLDRDQUFpQyxjQUFjLEVBQUU7QUFBQSxFQUk3RCxJQUFJLFdBQVcsU0FBUyxTQUFTLEdBQUc7QUFBQSxJQUNuQyxNQUFNLEtBQUssc0NBQXFDLEVBQUU7QUFBQSxJQUVsRCxTQUFTLFVBQVUsV0FBVyxTQUFTLE1BQU0sR0FBRyxDQUFDO0FBQUEsTUFDaEQsTUFBTSxLQUNMLE9BQU8sT0FBTyxXQUFXLFlBQVksT0FBTyxRQUFRLE9BQU8sT0FBTyxJQUFJLE1BQU0sYUFBYSxPQUFPLE9BQU8sU0FBUyxPQUFPLE9BQU8sU0FBUyxJQUN4STtBQUFBLElBR0QsTUFBTSxLQUFLLEVBQUU7QUFBQTtBQUFBLEVBSWQsSUFBSSxXQUFXLFNBQVMsU0FBUyxHQUFHO0FBQUEsSUFDbkMsTUFBTSxLQUFLLHNDQUFxQyxFQUFFO0FBQUEsSUFFbEQsU0FBUyxVQUFVLFdBQVcsU0FBUyxNQUFNLEdBQUcsQ0FBQztBQUFBLE1BQ2hELE1BQU0sS0FDTCxPQUFPLE9BQU8sV0FBVyxZQUFZLE9BQU8sUUFBUSxPQUFPLE9BQU8sSUFBSSxNQUFNLGFBQWEsT0FBTyxPQUFPLFNBQVMsT0FBTyxPQUFPLFNBQVMsSUFDeEk7QUFBQSxJQUdELE1BQU0sS0FBSyxFQUFFO0FBQUE7QUFBQSxFQUlkLElBQUksZUFBZSxTQUFTLFFBQzFCLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxjQUFjLFFBQVEsRUFDN0MsS0FBSyxDQUFDLEdBQUcsTUFBTSxLQUFLLElBQUksRUFBRSxPQUFPLE9BQU8sSUFBSSxLQUFLLElBQUksRUFBRSxPQUFPLE9BQU8sQ0FBQztBQUFBLEVBRXhFLElBQUksYUFBYSxTQUFTLEdBQUc7QUFBQSxJQUM1QixNQUFNLEtBQUsscUNBQTBCLEVBQUU7QUFBQSxJQUV2QyxTQUFTLFVBQVUsYUFBYSxNQUFNLEdBQUcsQ0FBQztBQUFBLE1BQ3pDLE1BQU0sS0FDTCxPQUFPLE9BQU8sV0FBVyxZQUFZLE9BQU8sUUFBUSxPQUFPLE9BQU8sSUFBSSxNQUFNLGFBQWEsT0FBTyxPQUFPLFNBQVMsT0FBTyxPQUFPLFNBQVMsSUFDeEk7QUFBQTtBQUFBLEVBSUYsT0FBTyxNQUFNLEtBQUs7QUFBQSxDQUFJO0FBQUE7IiwKICAiZGVidWdJZCI6ICIyRkMzNURGOTM0Njg1REFENjQ3NTZFMjE2NDc1NkUyMSIsCiAgIm5hbWVzIjogW10KfQ==
